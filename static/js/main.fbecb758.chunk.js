(this["webpackJsonpremote-work-equipment-stand"]=this["webpackJsonpremote-work-equipment-stand"]||[]).push([[0],{105:function(e,n,t){},113:function(e,n,t){"use strict";t.r(n);var r=t(0),a=t(27),c=t.n(a),i=t(54),o=t(47),s=t(77),u=t(78),l=function(){function e(n){Object(s.a)(this,e),this.signaling=void 0,this.signaling=n}return Object(u.a)(e,[{key:"send",value:function(e){this.signaling.send(JSON.stringify({data:e}))}},{key:"onmessage",set:function(e){var n=this,t=function(n){var t=n.data;e(JSON.parse(t))};this.signaling.addEventListener("message",t),this.unsubscribe=function(){console.log("unsubscribe from message"),n.signaling.removeEventListener("message",t)}}},{key:"unsubscribe",value:function(){console.error("Method unsubscribe is not implemented")}}]),e}(),d=t(36),b=t(158),f=t(171),j=t(166),p=t(162),O=t(173),g=t(156),m=t(147),v=t(60),h=t.n(v),x=t(12),k=t(18),y=t(148),w=t(149),C=t(150),S=t(170),L=t(152),E=t(153),P=t(154),D=t(151),R=t(155),I=t(157),N=t(50),T=t(165),q=t(145),F=t(62),A=t(4),M=function(e){var n=e.value;return Object(A.jsxs)(T.a,{display:"flex",alignItems:"center",children:[Object(A.jsx)(T.a,{width:"100%",mr:1,children:Object(A.jsx)(q.a,Object(N.a)({variant:"determinate"},e))}),Object(A.jsx)(T.a,{minWidth:35,children:Object(A.jsx)(F.a,{variant:"body2",color:"textSecondary",children:"".concat(Math.round(n),"%")})})]})},_=t(40),G=Object(m.a)((function(){return{button:{marginRight:"0.5rem"},progress:{width:"100%"},file:{display:"flex"}}})),U=function(e){var n=e.pcRef,t=Object(x.c)(),a=G(),c=Object(x.d)((function(e){return e.webrtc.peerConnectionOpen})),i=Object(x.d)((function(e){return e.fileLoader}),x.b),s=i.maxProgress,u=i.progressValue,l=Object(r.useState)(null),d=Object(o.a)(l,2),b=d[0],f=d[1];Object(r.useEffect)((function(){var e=window,n=function(e){e.stopPropagation(),e.preventDefault()},t=function(e){e.stopPropagation(),e.preventDefault()},r=function(e){e.stopPropagation(),e.preventDefault();var n=e.dataTransfer;(null===n||void 0===n?void 0:n.files)&&f(n.files[0])};return e.addEventListener("dragenter",n),e.addEventListener("dragover",t),e.addEventListener("drop",r),function(){e.removeEventListener("dragenter",n),e.removeEventListener("dragover",t),e.removeEventListener("drop",r)}}),[]);var j,p,O=function(){f(null)};return Object(A.jsxs)("section",{children:[Object(A.jsx)("input",{type:"file",id:"files",style:{display:"none"},onChange:function(e){var n=e.target.files;f(n[0])}}),b&&Object(A.jsx)(y.a,{className:a.file,children:Object(A.jsxs)(w.a,{children:[Object(A.jsx)(C.a,{children:Object(A.jsx)(S.a,{children:Object(A.jsx)(D.a,{})})}),Object(A.jsx)(L.a,{primary:b.name,secondary:new Date(b.lastModified).toLocaleString(),title:"".concat(b.size," \u0431\u0430\u0439\u0442")}),Object(A.jsx)(E.a,{children:Object(A.jsx)(P.a,{edge:"end","aria-label":"delete",onClick:O,children:Object(A.jsx)(R.a,{})})})]})}),u>0&&b?Object(A.jsx)("div",{className:a.progress,children:Object(A.jsx)(M,{value:(j=u,p=s,100*(j-0)/(p-0))})}):Object(A.jsx)("br",{}),b&&Object(A.jsx)(g.a,{component:"button",color:"primary",onClick:function(){if(n.current&&c)if(b){var e=n.current.createDataChannel(b.name);e.binaryType="arraybuffer",t(Object(_.b)(b.size));var r=new FileReader,a=0;r.addEventListener("error",(function(e){console.error("Error reading selectedFile: ",e)})),r.addEventListener("abort",(function(e){console.log("File reading aborted: ",e)}));var i=!1,o=function(e){console.log("readSlice",e);var n=b.slice(a,e+61440);r.readAsArrayBuffer(n)};r.addEventListener("load",(function(n){var r;if(console.log("FileReader.onload",n),(null===(r=n.target)||void 0===r?void 0:r.result)&&"open"===e.readyState)if(i)console.warn("Unable to write, data channel is paused!");else{var c=n.target.result;if(e.send(c),a+=c.byteLength,t(Object(_.c)(a)),a>=b.size)return e.send("EOF"),e.close(),f(null),t(Object(_.b)(0)),t(Object(_.c)(0)),O(),void t(Object(k.d)("\u0424\u0430\u0439\u043b \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d"));i||e.bufferedAmount<1048576?o(a):(console.log("Data channel ".concat(e.label," paused @ ").concat(e.bufferedAmount)),i=!0)}else console.warn("sendFileChannel.readyState is not open:",e.readyState)})),e.bufferedAmountLowThreshold=262144,e.addEventListener("bufferedamountlow",(function(){i&&(console.debug("Data channel ".concat(e.label," resumed @ ").concat(e.bufferedAmount)),i=!1,o(a))})),e.onopen=function(){o(0)}}else t(Object(k.c)("\u0424\u0430\u0439\u043b \u043d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d"));else t(Object(k.c)("\u041d\u0435 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043e \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0441\u043e \u0441\u0442\u0435\u043d\u0434\u043e\u043c"))},variant:"contained",type:"submit",size:"small",className:a.button,endIcon:Object(A.jsx)(h.a,{}),children:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"}),Object(A.jsx)(g.a,{component:"label",htmlFor:"files",variant:"contained",size:"small",id:"files",startIcon:Object(A.jsx)(I.a,{}),disabled:!c,children:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u043f\u0440\u043e\u0448\u0438\u0432\u043a\u0443"})]})},z=t(32),W={iceServers:[{url:"stun:stun.l.google.com:19302"},{url:"stun:stun1.l.google.com:19302"},{url:"stun:stun2.l.google.com:19302"},{url:"stun:stun3.l.google.com:19302"},{urls:"turn:numb.viagenie.ca",credential:"9u7prU:2}R{Sut~.)d[bP7,;Pgc'Pa",username:"fkrveacbukypqsqyaq@miucce.com"}]},H=Object(m.a)((function(e){return{root:{flexGrow:1,"& > *":{margin:e.spacing(1)},padding:"2rem"},formControl:{margin:e.spacing(1),minWidth:"10rem"},video:{display:"flex",justifyContent:"center",flexDirection:"column",backgroundImage:"url(".concat("/remote-work-equipment-stand","/chip.png)"),backgroundSize:"5.5rem",backgroundRepeat:"space",width:"100%",minHeight:"30rem"}}})),J=function(){var e=Object(x.c)(),n=H(),t=Object(x.d)((function(e){return e.auth.id_token})),a=Object(x.d)((function(e){return e.webrtc.peerConnectionOpen})),s=Object(x.d)((function(e){return e.webrtc.dataChannelOpen})),u=Object(r.useRef)(null),m=Object(r.useRef)(null),v=Object(r.useRef)(null),y=Object(r.useState)(""),w=Object(o.a)(y,2),C=w[0],S=w[1],L=Object(r.useState)(""),E=Object(o.a)(L,2),P=E[0],D=E[1];Object(r.useEffect)((function(){if(""!==P){var n,r,a,s=(n="room",r=P,new URLSearchParams(Object(d.a)({},n,r)).toString()),b=new URL("".concat(s&&"?".concat(s)),"wss://wss-signaling.herokuapp.com").toString(),f=new WebSocket(b,["id_token",t]),j=function(e){console.log("CLOSE WS",e)},p=function(n){console.log("OPEN WS",n),(a=new l(f)).send({getRemoteMedia:!0});var t=new RTCPeerConnection(W);m.current=t,t.ontrack=function(n){var t=n.track,r=Object(o.a)(n.streams,1)[0];t.onunmute=function(){e(Object(z.e)()),e(Object(k.d)("\u0421\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043e")),u.current.srcObject||(u.current.srcObject=r)}};var r=!1,s=!1,d=!1;t.onicecandidate=function(e){var n=e.candidate;a.send({candidate:n})},t.onnegotiationneeded=Object(i.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=!0,e.next=4,t.setLocalDescription();case 4:a.send({description:t.localDescription}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0);case 10:return e.prev=10,r=!1,e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[0,7,10,13]])}))),t.oniceconnectionstatechange=function(){"failed"===t.iceConnectionState&&t.restartIce()},a.onmessage=function(){var e=Object(i.a)(c.a.mark((function e(n){var i,o,u,l,b;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n.data,o=n.data,u=o.description,l=o.candidate,console.log(i),e.prev=2,!u){e.next=19;break}if(b=!r&&("stable"===t.signalingState||d),"offer"===u.type&&!b,!(s=!1)){e.next=9;break}return e.abrupt("return");case 9:return d="answer"===u.type,e.next=12,t.setRemoteDescription(u);case 12:if(d=!1,"offer"!==u.type){e.next=17;break}return e.next=16,t.setLocalDescription();case 16:a.send({description:t.localDescription});case 17:e.next=29;break;case 19:if(!l){e.next=29;break}return e.prev=20,e.next=23,t.addIceCandidate(l);case 23:e.next=29;break;case 25:if(e.prev=25,e.t0=e.catch(20),s){e.next=29;break}throw e.t0;case 29:e.next=34;break;case 31:e.prev=31,e.t1=e.catch(2),console.error(e.t1);case 34:case"end":return e.stop()}}),e,null,[[2,31],[20,25]])})));return function(n){return e.apply(this,arguments)}}()},O=function(n){console.error("ERROR WS",n),e(Object(k.c)("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u0440\u0438\u0441\u043e\u0435\u0434\u0438\u043d\u0438\u0442\u044c\u0441\u044f \u043a \u0441\u0442\u0435\u043d\u0434\u0443 ".concat(P)))};return f.addEventListener("open",p),f.addEventListener("close",j),f.addEventListener("error",O),function(){f.close(1e3,"change room"),v.current&&(v.current.close(),v.current=null,e(Object(z.b)())),m.current&&(m.current.close(),m.current=null,e(Object(z.d)())),f.removeEventListener("open",p),f.removeEventListener("close",j),f.removeEventListener("error",O),a&&a.unsubscribe(),u.current&&(u.current.srcObject=null)}}}),[P]),Object(r.useEffect)((function(){var e=function(){var e=Object(i.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("visible"!==document.visibilityState||!document.pictureInPictureElement){e.next=3;break}return e.next=3,document.exitPictureInPicture();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return document.addEventListener("visibilitychange",e),function(){document.removeEventListener("visibilitychange",e)}}),[]);var R=function(){var e=Object(i.a)(c.a.mark((function e(n){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(t=u.current)||void 0===t?void 0:t.srcObject){e.next=2;break}return e.abrupt("return");case 2:if(!document.pictureInPictureElement){e.next=7;break}return e.next=5,document.exitPictureInPicture();case 5:e.next=10;break;case 7:if(!document.pictureInPictureEnabled){e.next=10;break}return e.next=10,n.currentTarget.requestPictureInPicture();case 10:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return Object(A.jsxs)("div",{className:n.root,children:[Object(A.jsxs)(b.a,{variant:"standard",className:n.formControl,children:[Object(A.jsx)(f.a,{htmlFor:"outlined-room-native-simple",children:"\u0421\u0442\u0435\u043d\u0434"}),Object(A.jsx)(j.a,{native:!0,value:P,onChange:function(e){var n=e.target.value;"string"===typeof n?D(n):console.error("Room is not a string: ",n)},label:"\u0421\u0442\u0435\u043d\u0434\u0430",inputProps:{name:"\u0421\u0442\u0435\u043d\u0434",id:"outlined-room-native-simple"},children:Array.from({length:5},(function(e,n){return n})).map((function(e){var n=0===e,t=n?"":e.toString();return Object(A.jsx)("option",{value:t,disabled:n,"aria-label":n?"None":t,children:t},t)}))})]}),Object(A.jsx)("section",{className:n.video,children:Object(A.jsx)("video",{ref:u,autoPlay:!0,playsInline:!0,onClick:R})}),Object(A.jsx)(U,{pcRef:m}),Object(A.jsx)("section",{children:Object(A.jsxs)(p.a,{container:!0,spacing:1,alignItems:"flex-end",children:[Object(A.jsx)(p.a,{item:!0,children:Object(A.jsx)(O.a,{label:"\u041a\u043e\u043c\u0430\u043d\u0434\u0430",multiline:!0,value:C,onChange:function(n){if(a){if(!s){v.current=m.current.createDataChannel("sendDataChannel");var t=v.current;t.onopen=function(){e(Object(z.c)())},t.onclose=function(){e(Object(z.b)())}}S(n.target.value)}else e(Object(k.c)("\u041d\u0435 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043e \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0441\u043e \u0441\u0442\u0435\u043d\u0434\u043e\u043c"))},disabled:!a})}),Object(A.jsx)(p.a,{item:!0,children:Object(A.jsx)(g.a,{component:"button",color:"primary",onClick:function(){v.current&&s&&(v.current.send(C),e(Object(k.d)("\u041a\u043e\u043c\u0430\u043d\u0434\u0430 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0430")),S(""))},variant:"text",type:"submit",size:"small",disabled:!s||!(null===C||void 0===C?void 0:C.trim()),endIcon:Object(A.jsx)(h.a,{}),children:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"})})]})})]})},V=t(161),B=t(164),K=t(61),Q=t(167),X=t(169),Y=function(e){var n=e.snackbarDelay,t=Object(x.c)(),r=Object(x.d)((function(e){return e.snackbar}),x.b),a=r.open,c=r.snackbarMessage,i=r.type,o=function(){t(Object(k.a)())};return Object(A.jsx)(X.a,{open:a,autoHideDuration:n,onClose:o,onClick:o,children:Object(A.jsx)(Q.a,{severity:i,children:c})})};Y.defaultProps={snackbarDelay:6e3};var Z=t(163),$=t(43),ee=t(74),ne=Object(m.a)((function(e){return{layout:Object(d.a)({width:"auto",marginLeft:e.spacing(2),marginRight:e.spacing(2)},e.breakpoints.up(350+2*e.spacing(2)),{width:350,marginLeft:"auto",marginRight:"auto"}),paper:Object(d.a)({marginTop:e.spacing(3),marginBottom:e.spacing(3),padding:e.spacing(2),height:190},e.breakpoints.up(350+2*e.spacing(3)),{marginTop:e.spacing(6),marginBottom:e.spacing(6),padding:e.spacing(3)}),button:{marginTop:e.spacing(3),display:"flex",justifyContent:"center"}}})),te=function(){var e=ne(),n=Object(x.c)();return Object(A.jsx)("main",{className:e.layout,children:Object(A.jsxs)(V.a,{className:e.paper,variant:"outlined",square:!0,children:[Object(A.jsx)(F.a,{component:"h5",variant:"h5",align:"center",children:"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f"}),Object(A.jsx)("div",{className:e.button,children:Object(A.jsx)(K.GoogleLogin,{clientId:ee.GOOGLE_AUTH,buttonText:"\u0412\u043e\u0439\u0442\u0438",onSuccess:function(e){e.code?console.warn(e):n(Object($.c)(Object(N.a)(Object(N.a)({},e.profileObj),{},{id_token:e.tokenObj.id_token})))},onFailure:function(e){console.error(e)},cookiePolicy:"single_host_origin",isSignedIn:!0})})]})})},re=t(74);n.default=function(){var e=Object(x.c)(),n=Object(x.d)((function(e){return e.auth}),x.b),t=n.imageUrl,r=n.email,a=n.name,c=!!a;return Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(Z.a,{}),Object(A.jsx)(Y,{}),c?Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(V.a,{elevation:1,variant:"outlined",square:!0,children:Object(A.jsxs)(B.a,{children:[Object(A.jsx)(T.a,{mr:1,children:Object(A.jsx)(S.a,{alt:a,src:t})}),Object(A.jsx)(L.a,{primary:a,secondary:r}),Object(A.jsx)(K.GoogleLogout,{clientId:re.GOOGLE_AUTH,buttonText:"\u0412\u044b\u0439\u0442\u0438",onLogoutSuccess:function(){e(Object($.a)())}})]})}),Object(A.jsx)(T.a,{m:2,children:Object(A.jsx)(V.a,{elevation:3,variant:"outlined",children:Object(A.jsx)(J,{})})})]}):Object(A.jsx)(te,{})]})}},114:function(e,n,t){"use strict";t.r(n);t(0);var r=t(9),a=t.n(r),c=t(12),i=t(17),o=t(43),s=t(40),u=Object(i.b)({name:"led",initialState:{pin1:!1,pin2:!1,pin3:!1},reducers:{setLed:function(e,n){return n.payload}}}),l=(u.actions.setLed,u.reducer),d=t(18),b=t(32),f=t(20),j=Object(f.c)({auth:o.b,fileLoader:s.a,led:l,snackbar:d.b,webrtc:b.a});var p=Object(i.a)({reducer:j}),O=(t(105),t(4));!function(){var e=t(113).default;a.a.render(Object(O.jsx)(c.a,{store:p,children:Object(O.jsx)(e,{})}),document.getElementById("root"))}()},18:function(e,n,t){"use strict";t.d(n,"d",(function(){return o})),t.d(n,"c",(function(){return s})),t.d(n,"a",(function(){return u}));var r=t(17),a={snackbarMessage:"",type:"info",open:!1},c=Object(r.b)({name:"snackbar",initialState:a,reducers:{reset:function(){return a},setSnackbarSuccess:function(e,n){return e.snackbarMessage=n.payload,e.type="success",e.open=!0,e},setSnackbarError:function(e,n){return e.snackbarMessage=n.payload,e.type="error",e.open=!0,e},closeSnackbar:function(e){return e.open=!1,e}}}),i=c.actions,o=(i.reset,i.setSnackbarSuccess),s=i.setSnackbarError,u=i.closeSnackbar;n.b=c.reducer},32:function(e,n,t){"use strict";t.d(n,"d",(function(){return o})),t.d(n,"e",(function(){return s})),t.d(n,"c",(function(){return u})),t.d(n,"b",(function(){return l}));var r=t(17),a={peerConnectionOpen:!1,dataChannelOpen:!1},c=Object(r.b)({name:"webrtc",initialState:a,reducers:{reset:function(){return a},setPeerConnectionClose:function(e){return e.peerConnectionOpen=!1,e},setPeerConnectionOpen:function(e){return e.peerConnectionOpen=!0,e},setDataChannelOpen:function(e){return e.dataChannelOpen=!0,e},setDataChannelClose:function(e){return e.dataChannelOpen=!1,e}}}),i=c.actions,o=(i.reset,i.setPeerConnectionClose),s=i.setPeerConnectionOpen,u=i.setDataChannelOpen,l=i.setDataChannelClose;n.a=c.reducer},40:function(e,n,t){"use strict";t.d(n,"b",(function(){return o})),t.d(n,"c",(function(){return s}));var r=t(17),a={maxProgress:0,progressValue:0},c=Object(r.b)({name:"fileLoader",initialState:a,reducers:{reset:function(){return a},setMaxProgress:function(e,n){return e.maxProgress=n.payload,e},setProgressValue:function(e,n){return e.progressValue=n.payload,e}}}),i=c.actions,o=(i.reset,i.setMaxProgress),s=i.setProgressValue;n.a=c.reducer},43:function(e,n,t){"use strict";t.d(n,"c",(function(){return o})),t.d(n,"a",(function(){return s}));var r=t(17),a={googleId:"",imageUrl:"",email:"",name:"",givenName:"",familyName:"",id_token:""},c=Object(r.b)({name:"auth",initialState:a,reducers:{getProfile:function(e,n){return n.payload},clearProfile:function(){return a}}}),i=c.actions,o=i.getProfile,s=i.clearProfile;n.b=c.reducer},74:function(e){e.exports=JSON.parse('{"GOOGLE_AUTH":"930914015370-b31p63biqg1j0pbfr96qei9ujp1ttded.apps.googleusercontent.com"}')}},[[114,1,2]]]);
//# sourceMappingURL=main.fbecb758.chunk.js.map