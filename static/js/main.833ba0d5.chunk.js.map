{"version":3,"sources":["features/auth/Auth.tsx","components/FileUploader.tsx","features/led/LedIndicator.tsx","app/App.tsx","app/rootReducer.ts","app/store.ts","index.tsx","features/auth/authSlice.ts","features/led/ledSlice.ts"],"names":["useStyles","makeStyles","root","flexGrow","Auth","dispatch","useDispatch","useSelector","state","auth","shallowEqual","imageUrl","email","name","classes","isAuthenticated","Toolbar","className","List","ListItem","ListItemAvatar","Avatar","alt","src","ListItemText","primary","secondary","ListItemSecondaryAction","clientId","API_KEYS","GOOGLE_AUTH","buttonText","onLogoutSuccess","clearProfile","onSuccess","response","getProfile","profileObj","onFailure","e","console","error","cookiePolicy","isSignedIn","theme","maxWidth","margin","spacing","FileUploader","useState","file","setFile","open","setOpen","useEffect","dropbox","window","dragenter","stopPropagation","preventDefault","dragover","drop","files","dataTransfer","addEventListener","removeEventListener","resetFileSelect","ref","current","value","defaultValue","sendFile","a","formData","FormData","append","axios","method","url","data","headers","useRef","encType","type","id","accept","style","display","onChange","target","lastModifiedDate","toLocaleString","title","size","IconButton","edge","aria-label","onClick","Button","component","htmlFor","variant","color","Snackbar","autoHideDuration","onClose","Alert","severity","LedIndicator","led","ws","WebSocket","onopen","log","send","onclose","event","onerror","onmessage","setLed","JSON","parse","close","onClickOn","onClickOff","Object","entries","map","idx","isOn","key","classNames","led__off","led__on","App","rootReducer","combineReducers","store","configureStore","reducer","require","default","ReactDOM","render","document","getElementById","initialState","authSlice","createSlice","reducers","action","payload","actions","ledSlice","pin1","pin2","pin3"],"mappings":"2SAgBMA,EAAYC,aAAW,iBAAO,CAClCC,KAAM,CACJC,SAAU,OAoECC,EAhEF,WACX,IAAMC,EAAWC,cADA,EAMbC,aAAY,SAACC,GAAD,OAAgBA,EAAMC,OAAMC,KAH1CC,EAHe,EAGfA,SACAC,EAJe,EAIfA,MACAC,EALe,EAKfA,KAEIC,EAAUd,IAEVe,IAAoBF,EAc1B,OACE,kBAACG,EAAA,EAAD,KACE,yBAAKC,UAAWH,EAAQZ,MACtB,kBAACgB,EAAA,EAAD,KACE,kBAACC,EAAA,EAAD,KACGN,GACD,kBAACO,EAAA,EAAD,KACE,kBAACC,EAAA,EAAD,KACE,kBAACA,EAAA,EAAD,CAAQC,IAAKT,EAAMU,IAAKZ,MAI5B,kBAACa,EAAA,EAAD,CACEC,QAASZ,EACTa,UAAWd,IAEb,kBAACe,EAAA,EAAD,KACGZ,EACC,kBAAC,eAAD,CACEa,SAAUC,EAASC,YACnBC,WAAW,iCACXC,gBAzBQ,WACtB3B,EAAS4B,kBA2BG,kBAAC,cAAD,CACEL,SAAUC,EAASC,YACnBC,WAAW,iCACXG,UAvCE,SAACC,GACjB9B,EAAS+B,YAAWD,EAASE,cAuCfC,UApCE,SAACC,GACjBC,QAAQC,MAAMF,IAoCAG,aAAa,qBACbC,YAAU,U,wHChEtB3C,EAAYC,aAAW,SAAC2C,GAAD,MAAY,CACvC1C,KAAM,CACJC,SAAU,EACV0C,SAAU,QACV,QAAS,CACPC,OAAQF,EAAMG,QAAQ,SA6IbC,EAxIM,WACnB,IAAMlC,EAAUd,IADS,EAEDiD,qBAFC,mBAElBC,EAFkB,KAEZC,EAFY,OAGDF,oBAAS,GAHR,mBAGlBG,EAHkB,KAGZC,EAHY,KAKzBC,qBAAU,WAER,IAAMC,EAAUC,OAMhB,SAASC,EAAUlB,GACjBA,EAAEmB,kBACFnB,EAAEoB,iBAGJ,SAASC,EAASrB,GAChBA,EAAEmB,kBACFnB,EAAEoB,iBAGJ,SAASE,EAAKtB,GACZA,EAAEmB,kBACFnB,EAAEoB,iBAEF,IACQG,EADGvB,EAAEwB,aACLD,MAERX,EAAQW,EAAM,IAGhB,OAxBAP,EAAQS,iBAAiB,YAAaP,GAAW,GACjDF,EAAQS,iBAAiB,WAAYJ,GAAU,GAC/CL,EAAQS,iBAAiB,OAAQH,GAAM,GAsBhC,WACLN,EAAQU,oBAAoB,YAAaR,GAAW,GACpDF,EAAQU,oBAAoB,WAAYL,GAAU,GAClDL,EAAQU,oBAAoB,OAAQJ,GAAM,MAE3C,IAEH,IAIMK,EAAkB,WACtBf,EAAQ,MAEJgB,EAAIC,UACND,EAAIC,QAAQC,MAAQF,EAAIC,QAAQE,eAI9BC,EAAQ,uCAAG,WAAOhC,GAAP,eAAAiC,EAAA,6DACfjC,EAAEoB,kBAEIc,EAAW,IAAIC,UACZC,OAAO,OAAQzB,GAJT,SAMT0B,IAAM,CACVC,OAAQ,OACRC,IAAK,qCACLC,KAAMN,EACNO,QAAS,CAAE,eAAgB,yBAVd,OAaf3B,GAAQ,GAERa,IAfe,2CAAH,sDAkBRC,EAAMc,iBAAyB,MAErC,OACE,yBAAKhE,UAAWH,EAAQZ,MACtB,0BAAM2E,OAAO,OAAOK,QAAQ,uBAC1B,2BACEf,IAAKA,EACLgB,KAAK,OACLC,GAAG,QACHC,OAAO,OACPC,MAAO,CAAEC,QAAS,QAClBC,SAzCiB,SAACjD,GACxBY,EAAQZ,EAAEkD,OAAO3B,MAAM,OA0ClBZ,GACC,kBAAChC,EAAA,EAAD,KACE,kBAACC,EAAA,EAAD,KACE,kBAACC,EAAA,EAAD,KACE,kBAACC,EAAA,EAAD,KACE,kBAAC,IAAD,QAGJ,kBAACG,EAAA,EAAD,CAAcC,QAASyB,EAAKrC,KAAMa,UAAWwB,EAAKwC,iBAAiBC,iBAAkBC,MAAK,UAAK1C,EAAK2C,KAAV,+BAC1F,kBAAClE,EAAA,EAAD,KACE,kBAACmE,EAAA,EAAD,CACEC,KAAK,MACLC,aAAW,SACXC,QAAS/B,GAET,kBAAC,IAAD,UAMV,kBAACgC,EAAA,EAAD,CACEC,UAAU,QACVC,QAAQ,QACRC,QAAQ,YACRR,KAAK,SAJP,0DAQC3C,GACC,oCACE,kBAACgD,EAAA,EAAD,CACEC,UAAU,SACVG,MAAM,UACNL,QAAS1B,EACT8B,QAAQ,YACRlB,KAAK,SACLU,KAAK,SANP,2DAYJ,kBAACU,EAAA,EAAD,CAAUnD,KAAMA,EAAMoD,iBAAkB,IAAMC,QAAS,kBAAMpD,GAAQ,KACnE,kBAACqD,EAAA,EAAD,CAAOC,SAAS,WAAhB,kI,kCChFKC,EA5DgB,WAC7B,IAAMC,EAAMtG,aAAY,SAACC,GAAD,OAAqBA,EAAMqG,MAAKnG,KAClDL,EAAWC,cACXwG,EAAK7B,iBAAkB,MAE7B3B,qBAAU,WAqBR,OApBCwD,EAAG1C,QAAwB,IAAI2C,UAAU,0BAE1CD,EAAG1C,QAAS4C,OAAS,WACnBxE,QAAQyE,IAAI,gBACZH,EAAG1C,QAAS8C,KAAK,qBAGnBJ,EAAG1C,QAAS+C,QAAU,SAACC,GACrB5E,QAAQyE,IAAI,uBAAwBG,IAGtCN,EAAG1C,QAASiD,QAAU,SAAC5E,GACrBD,QAAQyE,IAAI,WAAYxE,IAG1BqE,EAAG1C,QAASkD,UAAY,SAACF,GACvB5E,QAAQyE,IAAI,aAAcG,EAAMrC,MAChC1E,EAASkH,YAAOC,KAAKC,MAAML,EAAMrC,SAG5B,WACL+B,EAAG1C,QAASsD,WAEb,IAEH,IAOMC,EAAY,WAChBb,EAAG1C,QAAS8C,KAAK,OAGbU,EAAa,WACjBd,EAAG1C,QAAS8C,KAAK,QAMnB,OACE,yBAAKjG,UAAU,SACb,yBAAKA,UAAU,kBACZ4G,OAAOC,QAAQjB,GAAKkB,KArBT,SAAC,EAAiCC,GAAlC,uBAAEnH,EAAF,KAAQoH,EAAR,YAChB,yBAAKC,IAAKrH,EAAMI,UAAU,aACxB,8BAAO+G,EAAM,GACb,0BAAM/G,UAAWkH,IAAW,MAAO,CAAEC,UAAWH,EAAMI,QAASJ,WAYtC,kBAAC/B,EAAA,EAAD,CAAQG,QAAQ,YAAYJ,QAAS0B,EAAWrB,MAAM,WAAtD,oDACC,kBAACJ,EAAA,EAAD,CAAQG,QAAQ,YAAYJ,QAAS2B,EAAYtB,MAAM,aAAvD,4DChCjBgC,UAjBH,WACV,IACMvH,IADOR,aAAY,SAACC,GAAD,OAAgBA,EAAMC,KAAKI,QAGpD,OACE,oCACE,kBAAC,EAAD,MACCE,GACD,oCACE,kBAAC,EAAD,MACA,kBAAC,EAAD,U,oHCJOwH,EAPKC,YAAgB,CAClC/H,SACAoG,UCkBa4B,MAlBDC,YAAe,CAC3BC,QAASJ,I,OCDX,WAEE,IAAMD,EAAMM,EAAQ,KAAaC,QACjCC,IAASC,OACP,kBAAC,IAAD,CAAUN,MAAOA,GACf,kBAACH,EAAD,OAEFU,SAASC,eAAe,SAI5BF,I,gCClBA,gFAWMG,EAAe,GAEfC,EAAYC,YAAY,CAC5BvI,KAAM,OACNqI,eACAG,SAAU,CACRjH,WADQ,SACG5B,EAAO8I,GAChB,OAAOA,EAAOC,SAEhBtH,aAJQ,WAKN,OAAOiH,M,EAK+BC,EAAUK,QAAvCpH,E,EAAAA,WAAYH,E,EAAAA,aAEZkH,MAAf,S,gCC5BA,8CAcMM,EAAWL,YAAY,CAC3BvI,KAAM,MACNqI,aARwB,CACxBQ,MAAM,EACNC,MAAM,EACNC,MAAM,GAMNP,SAAU,CACR9B,OADQ,SACD/G,EAAO8I,GACZ,OAAOA,EAAOC,YAKLhC,EAAWkC,EAASD,QAApBjC,OAEAkC,MAAf,S","file":"static/js/main.833ba0d5.chunk.js","sourcesContent":["import React from 'react';\nimport { GoogleLogin, GoogleLogout } from 'react-google-login';\nimport { getProfile, clearProfile } from 'features/auth/authSlice';\nimport { shallowEqual, useDispatch, useSelector } from 'react-redux';\nimport {\n  Avatar,\n  List,\n  ListItem,\n  ListItemAvatar,\n  ListItemSecondaryAction,\n  ListItemText,\n  Toolbar,\n} from '@material-ui/core';\nimport API_KEYS from 'API_KEYS.json';\nimport { makeStyles } from '@material-ui/core/styles';\n\nconst useStyles = makeStyles(() => ({\n  root: {\n    flexGrow: 1,\n  },\n}));\n\nconst Auth = () => {\n  const dispatch = useDispatch();\n  const {\n    imageUrl,\n    email,\n    name,\n  } = useSelector((state: any) => state.auth, shallowEqual);\n  const classes = useStyles();\n\n  const isAuthenticated = !!name;\n\n  const onSuccess = (response: any) => {\n    dispatch(getProfile(response.profileObj));\n  };\n\n  const onFailure = (e: any) => {\n    console.error(e);\n  };\n\n  const onLogoutSuccess = () => {\n    dispatch(clearProfile());\n  };\n\n  return (\n    <Toolbar>\n      <div className={classes.root}>\n        <List>\n          <ListItem>\n            {name && (\n            <ListItemAvatar>\n              <Avatar>\n                <Avatar alt={name} src={imageUrl} />\n              </Avatar>\n            </ListItemAvatar>\n            )}\n            <ListItemText\n              primary={name}\n              secondary={email}\n            />\n            <ListItemSecondaryAction>\n              {isAuthenticated ? (\n                <GoogleLogout\n                  clientId={API_KEYS.GOOGLE_AUTH}\n                  buttonText=\"Выйти\"\n                  onLogoutSuccess={onLogoutSuccess}\n                />\n              ) : (\n                <GoogleLogin\n                  clientId={API_KEYS.GOOGLE_AUTH}\n                  buttonText=\"Войти\"\n                  onSuccess={onSuccess}\n                  onFailure={onFailure}\n                  cookiePolicy=\"single_host_origin\"\n                  isSignedIn\n                />\n              )}\n            </ListItemSecondaryAction>\n          </ListItem>\n        </List>\n      </div>\n    </Toolbar>\n  );\n};\n\nexport default Auth;\n","import React, { useState, useEffect, useRef } from 'react';\nimport {\n  Button, Snackbar, ListItemText, Avatar,\n  List, ListItem, ListItemAvatar, ListItemSecondaryAction, IconButton,\n} from '@material-ui/core';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { Alert } from '@material-ui/lab';\nimport FolderIcon from '@material-ui/icons/AddToPhotos';\nimport DeleteIcon from '@material-ui/icons/Delete';\nimport axios from 'axios';\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    flexGrow: 1,\n    maxWidth: '20rem',\n    '& > *': {\n      margin: theme.spacing(1),\n    },\n  },\n}));\n\nconst FileUploader = () => {\n  const classes = useStyles();\n  const [file, setFile] = useState();\n  const [open, setOpen] = useState(false);\n\n  useEffect(() => {\n    /* TODO - add drop it text on fullscreen */\n    const dropbox = window;\n\n    dropbox.addEventListener('dragenter', dragenter, false);\n    dropbox.addEventListener('dragover', dragover, false);\n    dropbox.addEventListener('drop', drop, false);\n\n    function dragenter(e: any) {\n      e.stopPropagation();\n      e.preventDefault();\n    }\n\n    function dragover(e: any) {\n      e.stopPropagation();\n      e.preventDefault();\n    }\n\n    function drop(e: any) {\n      e.stopPropagation();\n      e.preventDefault();\n\n      const dt = e.dataTransfer;\n      const { files } = dt;\n\n      setFile(files[0]);\n    }\n\n    return () => {\n      dropbox.removeEventListener('dragenter', dragenter, false);\n      dropbox.removeEventListener('dragover', dragover, false);\n      dropbox.removeEventListener('drop', drop, false);\n    };\n  }, []);\n\n  const handleFileSelect = (e: any) => {\n    setFile(e.target.files[0]);\n  };\n\n  const resetFileSelect = () => {\n    setFile(null);\n\n    if (ref.current) {\n      ref.current.value = ref.current.defaultValue;\n    }\n  };\n\n  const sendFile = async (e: any) => {\n    e.preventDefault();\n\n    const formData = new FormData();\n    formData.append('file', file);\n\n    await axios({\n      method: 'post',\n      url: 'http://localhost:8080/upload-image',\n      data: formData,\n      headers: { 'Content-Type': 'multipart/form-data' },\n    });\n\n    setOpen(true);\n\n    resetFileSelect();\n  };\n\n  const ref = useRef<HTMLInputElement>(null);\n\n  return (\n    <div className={classes.root}>\n      <form method=\"post\" encType=\"multipart/form-data\">\n        <input\n          ref={ref}\n          type=\"file\"\n          id=\"files\"\n          accept=\".jpg\"\n          style={{ display: 'none' }}\n          onChange={handleFileSelect}\n        />\n        {file && (\n          <List>\n            <ListItem>\n              <ListItemAvatar>\n                <Avatar>\n                  <FolderIcon />\n                </Avatar>\n              </ListItemAvatar>\n              <ListItemText primary={file.name} secondary={file.lastModifiedDate.toLocaleString()} title={`${file.size} байт`} />\n              <ListItemSecondaryAction>\n                <IconButton\n                  edge=\"end\"\n                  aria-label=\"delete\"\n                  onClick={resetFileSelect}\n                >\n                  <DeleteIcon />\n                </IconButton>\n              </ListItemSecondaryAction>\n            </ListItem>\n          </List>\n        )}\n        <Button\n          component=\"label\"\n          htmlFor=\"files\"\n          variant=\"contained\"\n          size=\"small\"\n        >\n          Загрузить\n        </Button>\n        {file && (\n          <>\n            <Button\n              component=\"button\"\n              color=\"primary\"\n              onClick={sendFile}\n              variant=\"contained\"\n              type=\"submit\"\n              size=\"small\"\n            >\n              Отправить\n            </Button>\n          </>\n        )}\n        <Snackbar open={open} autoHideDuration={6000} onClose={() => setOpen(false)}>\n          <Alert severity=\"success\">\n            Файл успешно отправлен\n          </Alert>\n        </Snackbar>\n      </form>\n    </div>\n  );\n};\n\nexport default FileUploader;\n","import React, { useEffect, useRef } from 'react';\nimport { shallowEqual, useDispatch, useSelector } from 'react-redux';\nimport classNames from 'classnames';\nimport 'features/led/LedIndicator.css';\nimport { setLed } from 'features/led/ledSlice';\nimport { AppStore } from 'app/store';\nimport { Button } from '@material-ui/core';\n\nconst LedIndicator: React.FC = () => {\n  const led = useSelector((state: AppStore) => state.led, shallowEqual);\n  const dispatch = useDispatch();\n  const ws = useRef<WebSocket>(null);\n\n  useEffect(() => {\n    (ws.current as WebSocket) = new WebSocket('ws://localhost:8080/ws');\n\n    ws.current!.onopen = () => {\n      console.log('WS connected');\n      ws.current!.send('Ping from client');\n    };\n\n    ws.current!.onclose = (event: CloseEvent) => {\n      console.log('WS closed connection', event);\n    };\n\n    ws.current!.onerror = (error) => {\n      console.log('WS error', error);\n    };\n\n    ws.current!.onmessage = (event: MessageEvent) => {\n      console.log('WS message', event.data);\n      dispatch(setLed(JSON.parse(event.data)));\n    };\n\n    return () => {\n      ws.current!.close();\n    };\n  }, []);\n\n  const renderLed = ([name, isOn]: [string, boolean], idx: number) => (\n    <div key={name} className=\"led__item\">\n      <span>{idx + 1}</span>\n      <span className={classNames('led', { led__off: !isOn, led__on: isOn })} />\n    </div>\n  );\n\n  const onClickOn = () => {\n    ws.current!.send('ON');\n  };\n\n  const onClickOff = () => {\n    ws.current!.send('OFF');\n  };\n\n  const renderButtonOn = () => <Button variant=\"contained\" onClick={onClickOn} color=\"primary\">Включить</Button>;\n  const renderButtonOff = () => <Button variant=\"contained\" onClick={onClickOff} color=\"secondary\">Выключить</Button>;\n\n  return (\n    <div className=\"board\">\n      <div className=\"led__container\">\n        {Object.entries(led).map(renderLed)}\n      </div>\n      {renderButtonOn()}\n      {renderButtonOff()}\n    </div>\n  );\n};\n\nexport default LedIndicator;\n","import React from 'react';\nimport Auth from 'features/auth/Auth';\nimport FileUploader from 'components/FileUploader';\nimport LedIndicator from 'features/led/LedIndicator';\nimport { useSelector } from 'react-redux';\n\nconst App = () => {\n  const name = useSelector((state: any) => state.auth.name);\n  const isAuthenticated = !!name;\n\n  return (\n    <>\n      <Auth />\n      {isAuthenticated && (\n      <>\n        <FileUploader />\n        <LedIndicator />\n      </>\n      )}\n    </>\n  );\n};\n\nexport default App;\n","import { combineReducers } from '@reduxjs/toolkit';\n\nimport auth from 'features/auth/authSlice';\nimport led from 'features/led/ledSlice';\n\nconst rootReducer = combineReducers({\n  auth,\n  led,\n});\n\nexport type RootState = ReturnType<typeof rootReducer>\n\nexport default rootReducer;\n","import { configureStore, Action } from '@reduxjs/toolkit';\nimport { ThunkAction } from 'redux-thunk';\n\nimport rootReducer, { RootState } from 'app/rootReducer';\nimport { Led } from 'features/led/ledSlice';\nimport { AuthState } from 'features/auth/authSlice';\n\nconst store = configureStore({\n  reducer: rootReducer,\n});\n\n// @ts-ignore\nif (process.env.NODE_ENV === 'development' && module.hot) {\n  // @ts-ignore\n  module.hot.accept('./rootReducer', () => {\n    // eslint-disable-next-line global-require\n    const newRootReducer = require('./rootReducer').default;\n    store.replaceReducer(newRootReducer);\n  });\n}\n\nexport type AppDispatch = typeof store.dispatch\nexport type AppThunk = ThunkAction<void, RootState, null, Action<string>>\nexport type AppStore = { led: Led, auth: AuthState };\n\nexport default store;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Provider } from 'react-redux';\n\nimport store from './app/store';\nimport './index.css';\n\nfunction render() {\n  // eslint-disable-next-line global-require\n  const App = require('./app/App').default;\n  ReactDOM.render(\n    <Provider store={store}>\n      <App />\n    </Provider>,\n    document.getElementById('root'),\n  );\n}\n\nrender();\n\n// @ts-ignore\nif (process.env.NODE_ENV === 'development' && module.hot) {\n  // @ts-ignore\n  module.hot.accept('./app/App', render);\n}\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\n\nexport type AuthState = {\n    googleId: string,\n    imageUrl: string,\n    email: string,\n    name: string,\n    givenName: string,\n    familyName: string,\n}\n\nconst initialState = {};\n\nconst authSlice = createSlice({\n  name: 'auth',\n  initialState,\n  reducers: {\n    getProfile(state, action: PayloadAction<AuthState>) {\n      return action.payload;\n    },\n    clearProfile() {\n      return initialState;\n    },\n  },\n});\n\nexport const { getProfile, clearProfile } = authSlice.actions;\n\nexport default authSlice.reducer;\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\n\nexport type Led = {\n  pin1: boolean,\n  pin2: boolean,\n  pin3: boolean,\n}\n\nconst initialState: Led = {\n  pin1: false,\n  pin2: false,\n  pin3: false,\n};\n\nconst ledSlice = createSlice({\n  name: 'led',\n  initialState,\n  reducers: {\n    setLed(state, action: PayloadAction<Led>) {\n      return action.payload;\n    },\n  },\n});\n\nexport const { setLed } = ledSlice.actions;\n\nexport default ledSlice.reducer;\n"],"sourceRoot":""}