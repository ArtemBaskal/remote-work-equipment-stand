{"version":3,"sources":["features/auth/authSlice.ts","features/led/ledSlice.ts","features/auth/Auth.tsx","helpers/SignalingChannel.js","features/rtc/RTCPlayer.tsx","helpers/helpers.js","features/led/LedIndicator.tsx","app/App.tsx","app/rootReducer.ts","app/store.ts","index.tsx"],"names":["initialState","authSlice","createSlice","name","reducers","getProfile","state","action","payload","clearProfile","actions","ledSlice","pin1","pin2","pin3","setLed","useStyles","makeStyles","root","flexGrow","Auth","dispatch","useDispatch","useSelector","auth","shallowEqual","imageUrl","email","classes","isAuthenticated","Toolbar","className","List","ListItem","ListItemAvatar","Avatar","alt","src","ListItemText","primary","secondary","ListItemSecondaryAction","clientId","API_KEYS","GOOGLE_AUTH","buttonText","onLogoutSuccess","onSuccess","response","profileObj","onFailure","e","console","error","cookiePolicy","isSignedIn","SignalingChannel","signaling","this","message","send","JSON","stringify","data","handler","onmessage","parse","configuration","iceServers","url","urls","credential","username","theme","maxWidth","margin","spacing","RTCPlayer","remoteVideoRef","useRef","dataChannelFileSenderRef","pcRef","useState","maxProgress","setMaxProgress","progressValue","setProgressValue","selectedFile","setSelectedFile","snackbarOpened","setSnackbarOpened","resetFileSelect","closeSnackbar","useEffect","queryParamKey","queryParamValue","roomQueryParam","URLSearchParams","toString","ws","WebSocket","pc","RTCPeerConnection","current","ontrack","track","stream","streams","onunmute","srcObject","makingOffer","ignoreOffer","isSettingRemoteAnswerPending","onicecandidate","candidate","onnegotiationneeded","a","setLocalDescription","description","localDescription","oniceconnectionstatechange","iceConnectionState","restartIce","log","readyForOffer","signalingState","type","setRemoteDescription","addIceCandidate","onSendChannelStateChange","readyState","target","addEventListener","channel","event","dropbox","window","dragenter","stopPropagation","preventDefault","dragover","drop","file","dataTransfer","files","removeEventListener","id","ref","style","display","onChange","lastModifiedDate","toLocaleString","title","size","IconButton","edge","aria-label","onClick","Button","component","htmlFor","variant","color","sendFileChannel","createDataChannel","binaryType","CHUNK_SIZE","fileReader","FileReader","offset","readSlice","byteOffset","slice","readAsArrayBuffer","result","close","loaded","onopen","Snackbar","open","autoHideDuration","onClose","Alert","severity","max","value","autoPlay","playsInline","LedIndicator","led","onclose","onerror","onClickOn","onClickOff","Object","entries","map","idx","isOn","key","classNames","led__off","led__on","App","rootReducer","combineReducers","store","configureStore","reducer","require","default","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.0672bcea.chunk.js","sourcesContent":["import { createSlice, PayloadAction } from '@reduxjs/toolkit';\n\nexport type AuthState = {\n    googleId: string,\n    imageUrl: string,\n    email: string,\n    name: string,\n    givenName: string,\n    familyName: string,\n}\n\nconst initialState = {};\n\nconst authSlice = createSlice({\n  name: 'auth',\n  initialState,\n  reducers: {\n    getProfile(state, action: PayloadAction<AuthState>) {\n      return action.payload;\n    },\n    clearProfile() {\n      return initialState;\n    },\n  },\n});\n\nexport const { getProfile, clearProfile } = authSlice.actions;\n\nexport default authSlice.reducer;\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\n\nexport type Led = {\n  pin1: boolean,\n  pin2: boolean,\n  pin3: boolean,\n}\n\nconst initialState: Led = {\n  pin1: false,\n  pin2: false,\n  pin3: false,\n};\n\nconst ledSlice = createSlice({\n  name: 'led',\n  initialState,\n  reducers: {\n    setLed(state, action: PayloadAction<Led>) {\n      return action.payload;\n    },\n  },\n});\n\nexport const { setLed } = ledSlice.actions;\n\nexport default ledSlice.reducer;\n","import React from 'react';\nimport { GoogleLogin, GoogleLogout } from 'react-google-login';\nimport { getProfile, clearProfile } from 'features/auth/authSlice';\nimport { shallowEqual, useDispatch, useSelector } from 'react-redux';\nimport {\n  Avatar,\n  List,\n  ListItem,\n  ListItemAvatar,\n  ListItemSecondaryAction,\n  ListItemText,\n  Toolbar,\n} from '@material-ui/core';\nimport API_KEYS from 'API_KEYS.json';\nimport { makeStyles } from '@material-ui/core/styles';\n\nconst useStyles = makeStyles(() => ({\n  root: {\n    flexGrow: 1,\n  },\n}));\n\nconst Auth = () => {\n  const dispatch = useDispatch();\n  const {\n    imageUrl,\n    email,\n    name,\n  } = useSelector((state: any) => state.auth, shallowEqual);\n  const classes = useStyles();\n\n  const isAuthenticated = !!name;\n\n  const onSuccess = (response: any) => {\n    dispatch(getProfile(response.profileObj));\n  };\n\n  const onFailure = (e: any) => {\n    console.error(e);\n  };\n\n  const onLogoutSuccess = () => {\n    dispatch(clearProfile());\n  };\n\n  return (\n    <Toolbar>\n      <div className={classes.root}>\n        <List>\n          <ListItem>\n            {name && (\n            <ListItemAvatar>\n              <Avatar>\n                <Avatar alt={name} src={imageUrl} />\n              </Avatar>\n            </ListItemAvatar>\n            )}\n            <ListItemText\n              primary={name}\n              secondary={email}\n            />\n            <ListItemSecondaryAction>\n              {isAuthenticated ? (\n                <GoogleLogout\n                  clientId={API_KEYS.GOOGLE_AUTH}\n                  buttonText=\"Выйти\"\n                  onLogoutSuccess={onLogoutSuccess}\n                />\n              ) : (\n                <GoogleLogin\n                  clientId={API_KEYS.GOOGLE_AUTH}\n                  buttonText=\"Войти\"\n                  onSuccess={onSuccess}\n                  onFailure={onFailure}\n                  cookiePolicy=\"single_host_origin\"\n                  isSignedIn\n                />\n              )}\n            </ListItemSecondaryAction>\n          </ListItem>\n        </List>\n      </div>\n    </Toolbar>\n  );\n};\n\nexport default Auth;\n","class SignalingChannel {\n  constructor(signaling) {\n    this.signaling = signaling;\n  }\n\n  send(message) {\n    this.signaling.send(JSON.stringify({ data: message }));\n  }\n\n  set onmessage(handler) {\n    this.signaling.onmessage = ({ data }) => {\n      handler(JSON.parse(data));\n    };\n  }\n}\n\nexport { SignalingChannel };\n","// @ts-nocheck\nimport React, { useEffect, useRef, useState } from 'react';\nimport { SignalingChannel } from 'helpers/SignalingChannel';\nimport { generateQueryParam } from 'helpers/helpers';\nimport 'features/rtc/RTCPlayer.css';\nimport {\n  Avatar,\n  Button,\n  IconButton,\n  List,\n  ListItem,\n  ListItemAvatar,\n  ListItemSecondaryAction,\n  ListItemText,\n  Snackbar,\n} from '@material-ui/core';\nimport FolderIcon from '@material-ui/icons/AddToPhotos';\nimport DeleteIcon from '@material-ui/icons/Delete';\nimport { Alert } from '@material-ui/lab';\nimport { makeStyles } from '@material-ui/core/styles';\n\nconst QUERY_PARAM_ROOM_NAME = 'room';\nconst FILE_DATA_CHANNEL_BINARY_TYPE = 'arraybuffer';\nconst END_OF_FILE_MESSAGE = 'EOF';\n\nconst configuration = {\n  iceServers: [\n    { url: 'stun:stun.l.google.com:19302' },\n    { url: 'stun:stun1.l.google.com:19302' },\n    { url: 'stun:stun2.l.google.com:19302' },\n    { url: 'stun:stun3.l.google.com:19302' },\n    {\n      urls: 'turn:numb.viagenie.ca',\n      credential: '9u7prU:2}R{Sut~.)d[bP7,;Pgc\\'Pa',\n      username: 'fkrveacbukypqsqyaq@miucce.com',\n    },\n  ],\n};\n\nconst EMPTY_PROGRESS = 0;\nconst SNACKBAR_DELAY = 6000;\nconst polite = true;\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    flexGrow: 1,\n    maxWidth: '20rem',\n    '& > *': {\n      margin: theme.spacing(1),\n    },\n  },\n}));\n\nconst RTCPlayer = () => {\n  const classes = useStyles();\n\n  const remoteVideoRef = useRef<HTMLVideoElement>(null);\n  const dataChannelFileSenderRef = useRef<HTMLInputElement>(null);\n  const pcRef = useRef(null);\n\n  const [maxProgress, setMaxProgress] = useState(EMPTY_PROGRESS);\n  const [progressValue, setProgressValue] = useState(EMPTY_PROGRESS);\n  const [selectedFile, setSelectedFile] = useState(null);\n  const [snackbarOpened, setSnackbarOpened] = useState(false);\n\n  const resetFileSelect = () => setSelectedFile(null);\n  const closeSnackbar = () => setSnackbarOpened(false);\n\n  useEffect(() => {\n    /* TODO add room selection */\n    const room = 1;\n    const roomQueryParam = generateQueryParam(QUERY_PARAM_ROOM_NAME, room);\n    const ws = new WebSocket(`wss://wss-signaling.herokuapp.com/${roomQueryParam && `?${roomQueryParam}`}`);\n\n    const signaling = new SignalingChannel(ws);\n\n    const pc = new RTCPeerConnection(configuration);\n    pcRef.current = pc;\n\n    pc.ontrack = ({ track, streams: [stream] }) => {\n      // once media for a remote track arrives, show it in the remote video element\n      // eslint-disable-next-line no-param-reassign\n      track.onunmute = () => {\n        // don't set srcObject again if it is already set.\n        if (remoteVideoRef.current.srcObject) {\n          return;\n        }\n        remoteVideoRef.current.srcObject = stream;\n      };\n    };\n\n    // - The perfect negotiation logic, separated from the rest of the application ---\n\n    // keep track of some negotiation state to prevent races and errors\n    let makingOffer = false;\n    let ignoreOffer = false;\n    let isSettingRemoteAnswerPending = false;\n\n    // send any ice candidates to the other peer\n    pc.onicecandidate = ({ candidate }) => {\n      signaling.send({ candidate });\n    };\n\n    // let the \"negotiationneeded\" event trigger offer generation\n    pc.onnegotiationneeded = async () => {\n      try {\n        makingOffer = true;\n        await pc.setLocalDescription();\n        signaling.send({ description: pc.localDescription });\n      } catch (err) {\n        console.error(err);\n      } finally {\n        makingOffer = false;\n      }\n    };\n\n    pc.oniceconnectionstatechange = () => {\n      if (pc.iceConnectionState === 'failed') {\n        pc.restartIce();\n      }\n    };\n\n    signaling.onmessage = async ({ data, data: { description, candidate } }) => {\n      console.log(data);\n\n      try {\n        if (description) {\n          // An offer may come in while we are busy processing SRD(answer).\n          // In this case, we will be in \"stable\" by the time the offer is processed\n          // so it is safe to chain it on our Operations Chain now.\n          const readyForOffer = !makingOffer\n                        && (pc.signalingState === 'stable' || isSettingRemoteAnswerPending);\n          const offerCollision = description.type === 'offer' && !readyForOffer;\n\n          ignoreOffer = !polite && offerCollision;\n          if (ignoreOffer) {\n            return;\n          }\n          isSettingRemoteAnswerPending = description.type === 'answer';\n          await pc.setRemoteDescription(description); // SRD rolls back as needed\n          isSettingRemoteAnswerPending = false;\n          if (description.type === 'offer') {\n            await pc.setLocalDescription();\n            signaling.send({ description: pc.localDescription });\n          }\n        } else if (candidate) {\n          try {\n            await pc.addIceCandidate(candidate);\n          } catch (err) {\n            if (!ignoreOffer) {\n              throw err;\n            } // Suppress ignored offer's candidates\n          }\n        }\n      } catch (err) {\n        console.error(err);\n      }\n    };\n\n    const onSendChannelStateChange = (e) => {\n      const { readyState } = e.target;\n      console.log('Send channel state is: %s', readyState);\n    };\n\n    /* TODO remove as far as we do not accept any messages */\n    pc.addEventListener('datachannel', ({ channel }) => {\n      channel.addEventListener('message', (event) => {\n        console.log('Received Message: %s', event.data);\n      });\n      channel.addEventListener('open', onSendChannelStateChange);\n      channel.addEventListener('close', onSendChannelStateChange);\n    });\n  }, []);\n\n  useEffect(() => {\n    /* TODO - add drop it text on fullscreen */\n    const dropbox = window;\n\n    dropbox.addEventListener('dragenter', dragenter, false);\n    dropbox.addEventListener('dragover', dragover, false);\n    dropbox.addEventListener('drop', drop, false);\n\n    function dragenter(e: any) {\n      e.stopPropagation();\n      e.preventDefault();\n    }\n\n    function dragover(e: any) {\n      e.stopPropagation();\n      e.preventDefault();\n    }\n\n    function drop(e: any) {\n      e.stopPropagation();\n      e.preventDefault();\n\n      const { dataTransfer: { files: [file] } } = e;\n      setSelectedFile(file);\n    }\n\n    return () => {\n      dropbox.removeEventListener('dragenter', dragenter, false);\n      dropbox.removeEventListener('dragover', dragover, false);\n      dropbox.removeEventListener('drop', drop, false);\n    };\n  }, []);\n\n  const onChange = (e) => {\n    const [file] = e.target.files;\n    setSelectedFile(file);\n  };\n\n  const sendFile = () => {\n    /*\n          Label may not be longer than 65,535 bytes.\n          https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/createDataChannel#parameters:~:text=channel.%20This%20string-,may%20not%20be%20longer%20than%2065%2C535%20bytes.\n          Filename sizes may not exceed 255 bytes.\n          https://www.ibm.com/support/knowledgecenter/SSEQVQ_8.1.10/client/c_cmd_filespecsyntax.html\n      */\n    const dataConstraint = null;\n    /* TODO improve selectedFile transfering https://github.com/webrtc/samples/blob/gh-pages/src/content/datachannel/filetransfer/js/main.js */\n    /* TODO reuse data channel */\n    const sendFileChannel = pcRef.current.createDataChannel(selectedFile.name, dataConstraint);\n    sendFileChannel.binaryType = FILE_DATA_CHANNEL_BINARY_TYPE;\n    setMaxProgress(selectedFile.size);\n\n    /*\n    Firefox cannot send a message larger than 16 Kbytes to Chrome\n    https://viblast.com/blog/2015/2/5/webrtc-data-channel-message-size/#blog-body:~:text=Firefox%20cannot%20send%20a%20message%20larger%20than%2016%20Kbytes%20to%20Chrome\n    Messages smaller than 16kiB can be sent without concern,\n    as all major user agents handle them the same way.\n    Beyond that, things get more complicated.\n    https://developer.mozilla.org/en-US/docs/Web/API/WebRTC_API/Using_data_channels#understanding_message_size_limits\n    */\n    const CHUNK_SIZE = 2 ** 14;\n\n    const fileReader = new FileReader();\n    let offset = 0;\n\n    fileReader.addEventListener('error', (error) => {\n      console.error('Error reading selectedFile: ', error);\n    });\n\n    fileReader.addEventListener('abort', (event) => {\n      console.log('File reading aborted: ', event);\n    });\n\n    const readSlice = (byteOffset) => {\n      console.log('readSlice', byteOffset);\n      const slice = selectedFile.slice(offset, byteOffset + CHUNK_SIZE);\n      fileReader.readAsArrayBuffer(slice);\n    };\n\n    fileReader.addEventListener('load', (e) => {\n      console.log('FileReader.onload', e);\n      sendFileChannel.send(e.target.result);\n\n      if (offset < selectedFile.size) {\n        readSlice(offset);\n      } else {\n        sendFileChannel.send(END_OF_FILE_MESSAGE);\n        sendFileChannel.close();\n        setSelectedFile(null);\n        /* Reset progress */\n        setMaxProgress(EMPTY_PROGRESS);\n        setProgressValue(EMPTY_PROGRESS);\n        resetFileSelect();\n        setSnackbarOpened(true);\n      }\n    });\n\n    fileReader.addEventListener('progress', (e) => {\n      offset += e.loaded;\n      setProgressValue(offset);\n    });\n\n    sendFileChannel.onopen = () => {\n      const FIRST_BYTE_SLICE_NUMBER = 0;\n      readSlice(FIRST_BYTE_SLICE_NUMBER);\n    };\n  };\n\n  return (\n    <div className={classes.root}>\n      <section>\n        <h4>Отправка файла прошивки</h4>\n        <input type=\"file\" id=\"files\" ref={dataChannelFileSenderRef} style={{ display: 'none' }} onChange={onChange} />\n        {selectedFile && (\n        <List>\n          <ListItem>\n            <ListItemAvatar>\n              <Avatar>\n                <FolderIcon />\n              </Avatar>\n            </ListItemAvatar>\n            <ListItemText primary={selectedFile.name} secondary={selectedFile.lastModifiedDate.toLocaleString()} title={`${selectedFile.size} байт`} />\n            <ListItemSecondaryAction>\n              <IconButton\n                edge=\"end\"\n                aria-label=\"delete\"\n                onClick={resetFileSelect}\n              >\n                <DeleteIcon />\n              </IconButton>\n            </ListItemSecondaryAction>\n          </ListItem>\n        </List>\n        )}\n        <br />\n        <Button\n          component=\"label\"\n          htmlFor=\"files\"\n          variant=\"contained\"\n          size=\"small\"\n          id=\"files\"\n        >\n          Выбрать\n        </Button>\n        {selectedFile && (\n          <>\n            <Button\n              component=\"button\"\n              color=\"primary\"\n              onClick={sendFile}\n              variant=\"contained\"\n              type=\"submit\"\n              size=\"small\"\n            >\n              Отправить\n            </Button>\n          </>\n        )}\n        <Snackbar\n          open={snackbarOpened}\n          autoHideDuration={SNACKBAR_DELAY}\n          onClose={closeSnackbar}\n          onClick={closeSnackbar}\n        >\n          <Alert severity=\"success\">\n            Файл успешно отправлен\n          </Alert>\n        </Snackbar>\n        {progressValue > EMPTY_PROGRESS\n        && selectedFile\n        && <progress max={maxProgress} value={progressValue} />}\n      </section>\n      <h4>Видео стенда</h4>\n      {/* eslint-disable-next-line jsx-a11y/media-has-caption */}\n      <video ref={remoteVideoRef} autoPlay playsInline />\n    </div>\n  );\n};\n\nexport default RTCPlayer;\n","export const generateQueryParam = (\n  queryParamKey, queryParamValue,\n) => new URLSearchParams({ [queryParamKey]: queryParamValue }).toString();\n","import React, { useEffect, useRef } from 'react';\nimport { shallowEqual, useDispatch, useSelector } from 'react-redux';\nimport classNames from 'classnames';\nimport 'features/led/LedIndicator.css';\nimport { setLed } from 'features/led/ledSlice';\nimport { AppStore } from 'app/store';\nimport { Button } from '@material-ui/core';\n\nconst LedIndicator: React.FC = () => {\n  const led = useSelector((state: AppStore) => state.led, shallowEqual);\n  const dispatch = useDispatch();\n  const ws = useRef<WebSocket>(null);\n\n  useEffect(() => {\n    (ws.current as WebSocket) = new WebSocket('ws://localhost:8080/ws');\n\n    ws.current!.onopen = () => {\n      console.log('WS connected');\n      ws.current!.send('Ping from client');\n    };\n\n    ws.current!.onclose = (event: CloseEvent) => {\n      console.log('WS closed connection', event);\n    };\n\n    ws.current!.onerror = (error) => {\n      console.log('WS error', error);\n    };\n\n    ws.current!.onmessage = (event: MessageEvent) => {\n      console.log('WS message', event.data);\n      dispatch(setLed(JSON.parse(event.data)));\n    };\n\n    return () => {\n      ws.current!.close();\n    };\n  }, []);\n\n  const renderLed = ([name, isOn]: [string, boolean], idx: number) => (\n    <div key={name} className=\"led__item\">\n      <span>{idx + 1}</span>\n      <span className={classNames('led', { led__off: !isOn, led__on: isOn })} />\n    </div>\n  );\n\n  const onClickOn = () => {\n    ws.current!.send('ON');\n  };\n\n  const onClickOff = () => {\n    ws.current!.send('OFF');\n  };\n\n  const renderButtonOn = () => <Button variant=\"contained\" onClick={onClickOn} color=\"primary\">Включить</Button>;\n  const renderButtonOff = () => <Button variant=\"contained\" onClick={onClickOff} color=\"secondary\">Выключить</Button>;\n\n  return (\n    <div className=\"board\">\n      <div className=\"led__container\">\n        {Object.entries(led).map(renderLed)}\n      </div>\n      {renderButtonOn()}\n      {renderButtonOff()}\n    </div>\n  );\n};\n\nexport default LedIndicator;\n","import React from 'react';\nimport Auth from 'features/auth/Auth';\nimport RTCPlayer from 'features/rtc/RTCPlayer';\nimport LedIndicator from 'features/led/LedIndicator';\nimport { useSelector } from 'react-redux';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars,no-unused-vars\nimport adapter from 'webrtc-adapter';\n\nconst App = () => {\n  const name = useSelector((state: any) => state.auth.name);\n  const isAuthenticated = !!name;\n\n  return (\n    <>\n      <Auth />\n      {isAuthenticated && (\n      <>\n        <RTCPlayer />\n        <LedIndicator />\n      </>\n      )}\n    </>\n  );\n};\n\nexport default App;\n","import { combineReducers } from '@reduxjs/toolkit';\n\nimport auth from 'features/auth/authSlice';\nimport led from 'features/led/ledSlice';\n\nconst rootReducer = combineReducers({\n  auth,\n  led,\n});\n\nexport type RootState = ReturnType<typeof rootReducer>\n\nexport default rootReducer;\n","import { configureStore, Action } from '@reduxjs/toolkit';\nimport { ThunkAction } from 'redux-thunk';\n\nimport rootReducer, { RootState } from 'app/rootReducer';\nimport { Led } from 'features/led/ledSlice';\nimport { AuthState } from 'features/auth/authSlice';\n\nconst store = configureStore({\n  reducer: rootReducer,\n});\n\n// @ts-ignore\nif (process.env.NODE_ENV === 'development' && module.hot) {\n  // @ts-ignore\n  module.hot.accept('./rootReducer', () => {\n    // eslint-disable-next-line global-require\n    const newRootReducer = require('./rootReducer').default;\n    store.replaceReducer(newRootReducer);\n  });\n}\n\nexport type AppDispatch = typeof store.dispatch\nexport type AppThunk = ThunkAction<void, RootState, null, Action<string>>\nexport type AppStore = { led: Led, auth: AuthState };\n\nexport default store;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Provider } from 'react-redux';\n\nimport store from './app/store';\nimport './index.css';\n\nfunction render() {\n  // eslint-disable-next-line global-require\n  const App = require('./app/App').default;\n  ReactDOM.render(\n    <Provider store={store}>\n      <App />\n    </Provider>,\n    document.getElementById('root'),\n  );\n}\n\nrender();\n\n// @ts-ignore\nif (process.env.NODE_ENV === 'development' && module.hot) {\n  // @ts-ignore\n  module.hot.accept('./app/App', render);\n}\n"],"sourceRoot":""}