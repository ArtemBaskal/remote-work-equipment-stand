(this["webpackJsonpremote-work-equipment-stand"]=this["webpackJsonpremote-work-equipment-stand"]||[]).push([[0],{100:function(e,t,n){},102:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(45),o=n.n(c),i=n(58),l=n(16),s=n(70),u=n(71),d=function(){function e(t){Object(s.a)(this,e),this.signaling=t}return Object(u.a)(e,[{key:"send",value:function(e){this.signaling.send(JSON.stringify({data:e}))}},{key:"unsubscribe",value:function(){console.error("Method unsubscribe is not implemented")}},{key:"onmessage",set:function(e){var t=this,n=function(t){var n=t.data;e(JSON.parse(n))};this.signaling.addEventListener("message",n),this.unsubscribe=function(){console.log("unsubscribe from message"),t.signaling.removeEventListener("message",n)}}}]),e}(),m=n(30),f=n(149),p=n(132),b=n(54),g=function(e){var t=e.value;return r.a.createElement(f.a,{display:"flex",alignItems:"center"},r.a.createElement(f.a,{width:"100%",mr:1},r.a.createElement(p.a,Object.assign({variant:"determinate"},e))),r.a.createElement(f.a,{minWidth:35},r.a.createElement(b.a,{variant:"body2",color:"textSecondary"},"".concat(Math.round(t),"%"))))},v=(n(100),n(135)),E=n(153),O=n(148),h=n(139),j=n(140),y=n(141),k=n(155),L=n(142),S=n(143),w=n(144),x=n(145),P=n(152),C=n(156),R=n(75),D=n.n(R),I=n(76),N=n.n(I),T=n(150),q=n(134),F=n(21),A={iceServers:[{url:"stun:stun.l.google.com:19302"},{url:"stun:stun1.l.google.com:19302"},{url:"stun:stun2.l.google.com:19302"},{url:"stun:stun3.l.google.com:19302"},{urls:"turn:numb.viagenie.ca",credential:"9u7prU:2}R{Sut~.)d[bP7,;Pgc'Pa",username:"fkrveacbukypqsqyaq@miucce.com"}]},G=Object(q.a)((function(e){return{root:{flexGrow:1,"& > *":{margin:e.spacing(1)},padding:"2rem"},progress:{width:"100%"},formControl:{margin:e.spacing(1),minWidth:"10rem"},video:{display:"flex",justifyContent:"center",flexDirection:"column",backgroundImage:"url(".concat("/remote-work-equipment-stand","/chip.png)"),backgroundSize:"5.5rem",backgroundRepeat:"space",width:"100%",minHeight:"30rem"},file:{display:"flex"}}})),_=function(){var e=G(),t=Object(F.d)((function(e){return e.auth.id_token})),n=Object(a.useRef)(null),c=Object(a.useRef)(null),s=Object(a.useRef)(null),u=Object(a.useState)(0),f=Object(l.a)(u,2),p=f[0],b=f[1],R=Object(a.useState)(0),I=Object(l.a)(R,2),q=I[0],_=I[1],U=Object(a.useState)(null),z=Object(l.a)(U,2),W=z[0],H=z[1],J=Object(a.useState)(""),M=Object(l.a)(J,2),B=M[0],K=M[1],Q=Object(a.useState)(""),V=Object(l.a)(Q,2),X=V[0],Y=V[1],Z=Object(a.useState)(""),$=Object(l.a)(Z,2),ee=$[0],te=$[1],ne=Object(a.useState)(!1),ae=Object(l.a)(ne,2),re=ae[0],ce=ae[1],oe=Object(a.useState)(""),ie=Object(l.a)(oe,2),le=ie[0],se=ie[1],ue=function(){return H(null)},de=function(){return K("")},me=function(){return Y("")};Object(a.useEffect)((function(){if(""!==le){var e,a,r,s=(e="room",a=le,new URLSearchParams(Object(m.a)({},e,a)).toString()),u=new URL("".concat(s&&"?".concat(s)),"wss://wss-signaling.herokuapp.com").toString(),f=new WebSocket(u,["id_token",t]),p=function(e){console.log("OPEN WS",e),(r=new d(f)).send({getRemoteMedia:!0});var t=new RTCPeerConnection(A);c.current=t,t.ontrack=function(e){var t=e.track,a=Object(l.a)(e.streams,1)[0];t.onunmute=function(){n.current.srcObject||(n.current.srcObject=a)}};var a=!1,s=!1,u=!1;t.onicecandidate=function(e){var t=e.candidate;r.send({candidate:t})},t.onnegotiationneeded=Object(i.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=!0,e.next=4,t.setLocalDescription();case 4:r.send({description:t.localDescription}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0);case 10:return e.prev=10,a=!1,e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[0,7,10,13]])}))),t.oniceconnectionstatechange=function(){"failed"===t.iceConnectionState&&t.restartIce()},r.onmessage=function(){var e=Object(i.a)(o.a.mark((function e(n){var c,i,l,d,m;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=n.data,i=n.data,l=i.description,d=i.candidate,console.log(c),e.prev=2,!l){e.next=19;break}if(m=!a&&("stable"===t.signalingState||u),"offer"===l.type&&!m,!(s=!1)){e.next=9;break}return e.abrupt("return");case 9:return u="answer"===l.type,e.next=12,t.setRemoteDescription(l);case 12:if(u=!1,"offer"!==l.type){e.next=17;break}return e.next=16,t.setLocalDescription();case 16:r.send({description:t.localDescription});case 17:e.next=29;break;case 19:if(!d){e.next=29;break}return e.prev=20,e.next=23,t.addIceCandidate(d);case 23:e.next=29;break;case 25:if(e.prev=25,e.t0=e.catch(20),s){e.next=29;break}throw e.t0;case 29:e.next=34;break;case 31:e.prev=31,e.t1=e.catch(2),console.error(e.t1);case 34:case"end":return e.stop()}}),e,null,[[2,31],[20,25]])})));return function(t){return e.apply(this,arguments)}}();var m=function(e){var t=e.target.readyState;console.log("Send channel state is: %s",t)};t.addEventListener("datachannel",(function(e){var t=e.channel;t.addEventListener("message",(function(e){console.log("Received Message: %s",e.data)})),t.addEventListener("open",m),t.addEventListener("close",m)}))};return f.addEventListener("open",p),f.addEventListener("close",(function(e){console.log("CLOSE WS",e)})),f.addEventListener("error",(function(e){console.error("ERROR WS",e),Y("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u0440\u0438\u0441\u043e\u0435\u0434\u0438\u043d\u0438\u0442\u044c\u0441\u044f \u043a \u0441\u0442\u0435\u043d\u0434\u0443 ".concat(le))})),function(){f.close(1e3,"change room"),c.current&&c.current.close(),f.removeEventListener("open",p),r&&r.unsubscribe(),n.current.srcObject=null}}}),[le]),Object(a.useEffect)((function(){var e=window;function t(e){e.stopPropagation(),e.preventDefault()}function n(e){e.stopPropagation(),e.preventDefault()}function a(e){e.stopPropagation(),e.preventDefault();var t=Object(l.a)(e.dataTransfer.files,1)[0];H(t)}return e.addEventListener("dragenter",t,!1),e.addEventListener("dragover",n,!1),e.addEventListener("drop",a,!1),function(){e.removeEventListener("dragenter",t,!1),e.removeEventListener("dragover",n,!1),e.removeEventListener("drop",a,!1)}}),[]),Object(a.useEffect)((function(){var e=function(){"visible"===document.visibilityState&&document.pictureInPictureElement&&document.exitPictureInPicture()};return document.addEventListener("visibilitychange",e),function(){document.removeEventListener("visibilitychange",e)}}),[]);var fe,pe;return r.a.createElement("div",{className:e.root},r.a.createElement(v.a,{variant:"standard",className:e.formControl},r.a.createElement(E.a,{htmlFor:"outlined-room-native-simple"},"\u0421\u0442\u0435\u043d\u0434"),r.a.createElement(O.a,{native:!0,value:le,onChange:function(e){se(e.target.value)},label:"\u0421\u0442\u0435\u043d\u0434\u0430",inputProps:{name:"\u0421\u0442\u0435\u043d\u0434",id:"outlined-room-native-simple"}},Array.from({length:5},(function(e,t){return t})).map((function(e){var t=0===e,n=t?"":e.toString();return r.a.createElement("option",{key:n,value:n,disabled:t,"aria-label":t?"None":n},n)})))),r.a.createElement("section",{className:e.video},r.a.createElement("video",{ref:n,autoPlay:!0,playsInline:!0,onClick:function(e){var t;(null===(t=n.current)||void 0===t?void 0:t.srcObject)&&(document.pictureInPictureElement?document.exitPictureInPicture():document.pictureInPictureEnabled&&e.target.requestPictureInPicture())}})),r.a.createElement("section",null,r.a.createElement("input",{type:"file",id:"files",style:{display:"none"},onChange:function(e){var t=Object(l.a)(e.target.files,1)[0];H(t)}}),W&&r.a.createElement(h.a,{className:e.file},r.a.createElement(j.a,null,r.a.createElement(y.a,null,r.a.createElement(k.a,null,r.a.createElement(D.a,null))),r.a.createElement(L.a,{primary:W.name,secondary:W.lastModifiedDate.toLocaleString(),title:"".concat(W.size," \u0431\u0430\u0439\u0442")}),r.a.createElement(S.a,null,r.a.createElement(w.a,{edge:"end","aria-label":"delete",onClick:ue},r.a.createElement(N.a,null))))),q>0&&W?r.a.createElement("div",{className:e.progress},r.a.createElement(g,{value:(fe=q,pe=p,100*(fe-0)/(pe-0))})):r.a.createElement("br",null),W&&r.a.createElement(x.a,{component:"button",color:"primary",onClick:function(){var e=c.current.createDataChannel(W.name,null);e.binaryType="arraybuffer",b(W.size);var t=new FileReader,n=0;t.addEventListener("error",(function(e){console.error("Error reading selectedFile: ",e)})),t.addEventListener("abort",(function(e){console.log("File reading aborted: ",e)}));var a=!1,r=function(e){console.log("readSlice",e);var a=W.slice(n,e+262144);t.readAsArrayBuffer(a)};t.addEventListener("load",(function(t){if(console.log("FileReader.onload",t),"open"===e.readyState)if(a)console.warn("Unable to write, data channel is paused!");else{var c=t.target.result;if(e.send(c),n+=c.byteLength,_(n),n>=W.size)return e.send("EOF"),e.close(),H(null),b(0),_(0),ue(),void K("\u0424\u0430\u0439\u043b \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d");a||e.bufferedAmount<1048576?r(n):(console.log("Data channel ".concat(e.label," paused @ ").concat(e.bufferedAmount)),a=!0)}else console.warn("sendFileChannel.readyState is not open:",e.readyState)})),e.bufferedAmountLowThreshold=262144,e.addEventListener("bufferedamountlow",(function(){a&&(console.debug("Data channel ".concat(e.label," resumed @ ").concat(e.bufferedAmount)),a=!1,r(n))})),e.onopen=function(){r(0)}},variant:"contained",type:"submit",size:"small"},"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"),r.a.createElement(x.a,{component:"label",htmlFor:"files",variant:"contained",size:"small",id:"files"},"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u043f\u0440\u043e\u0448\u0438\u0432\u043a\u0443"),r.a.createElement(P.a,{open:!!B,autoHideDuration:6e3,onClose:de,onClick:de},r.a.createElement(T.a,{severity:"success"},B)),r.a.createElement(P.a,{open:!!X,onClose:me,onClick:me},r.a.createElement(T.a,{severity:"error"},X))),r.a.createElement("section",null,r.a.createElement(C.a,{multiline:!0,value:ee,onChange:function(e){if(!s.current){s.current=c.current.createDataChannel("sendDataChannel",null);var t=s.current;t.onopen=function(){ce(!0)},t.onclose=function(){ce(!1)}}te(e.target.value)}}),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(x.a,{component:"button",color:"primary",onClick:function(){s.current&&re&&(s.current.send(ee),te(""))},variant:"contained",type:"submit",size:"small",disabled:!re},"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u043a\u043e\u043c\u0430\u043d\u0434\u0443")))},U=n(138),z=n(147),W=n(52),H=n(53),J=n(146),M=n(35),B=n(59),K=Object(q.a)((function(e){return{layout:Object(m.a)({width:"auto",marginLeft:e.spacing(2),marginRight:e.spacing(2)},e.breakpoints.up(350+2*e.spacing(2)),{width:350,marginLeft:"auto",marginRight:"auto"}),paper:Object(m.a)({marginTop:e.spacing(3),marginBottom:e.spacing(3),padding:e.spacing(2),height:190},e.breakpoints.up(350+2*e.spacing(3)),{marginTop:e.spacing(6),marginBottom:e.spacing(6),padding:e.spacing(3)}),button:{marginTop:e.spacing(3),display:"flex",justifyContent:"center"}}})),Q=function(){var e=K(),t=Object(F.c)();return r.a.createElement("main",{className:e.layout},r.a.createElement(U.a,{className:e.paper,variant:"outlined",square:!0},r.a.createElement(b.a,{component:"h5",variant:"h5",align:"center"},"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f"),r.a.createElement("div",{className:e.button},r.a.createElement(W.GoogleLogin,{clientId:H.GOOGLE_AUTH,buttonText:"\u0412\u043e\u0439\u0442\u0438",onSuccess:function(e){t(Object(M.c)(Object(B.a)(Object(B.a)({},e.profileObj),{},{id_token:e.tokenObj.id_token})))},onFailure:function(e){console.error(e)},cookiePolicy:"single_host_origin",isSignedIn:!0}))))};t.default=function(){var e=Object(F.c)(),t=Object(F.d)((function(e){return e.auth}),F.b),n=t.imageUrl,a=t.email,c=t.name,o=!!c;return r.a.createElement(r.a.Fragment,null,r.a.createElement(J.a,null),o?r.a.createElement(r.a.Fragment,null,r.a.createElement(U.a,{elevation:1,variant:"outlined",square:!0},r.a.createElement(z.a,null,r.a.createElement(f.a,{mr:1},r.a.createElement(k.a,{alt:c,src:n})),r.a.createElement(L.a,{primary:c,secondary:a}),r.a.createElement(W.GoogleLogout,{clientId:H.GOOGLE_AUTH,buttonText:"\u0412\u044b\u0439\u0442\u0438",onLogoutSuccess:function(){e(Object(M.a)())}}))),r.a.createElement(f.a,{m:2},r.a.createElement(U.a,{elevation:3,variant:"outlined"},r.a.createElement(_,null)))):r.a.createElement(Q,null))}},103:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(8),o=n.n(c),i=n(21),l=n(28),s=n(17),u=n(35),d=Object(l.b)({name:"led",initialState:{pin1:!1,pin2:!1,pin3:!1},reducers:{setLed:function(e,t){return t.payload}}}),m=(d.actions.setLed,d.reducer),f=Object(s.c)({auth:u.b,led:m});var p=Object(l.a)({reducer:f});n(98);!function(){var e=n(102).default;o.a.render(r.a.createElement(i.a,{store:p},r.a.createElement(e,null)),document.getElementById("root"))}()},35:function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return l}));var a=n(28),r={},c=Object(a.b)({name:"auth",initialState:r,reducers:{getProfile:function(e,t){return t.payload},clearProfile:function(){return r}}}),o=c.actions,i=o.getProfile,l=o.clearProfile;t.b=c.reducer},53:function(e){e.exports=JSON.parse('{"GOOGLE_AUTH":"930914015370-b31p63biqg1j0pbfr96qei9ujp1ttded.apps.googleusercontent.com"}')},88:function(e,t,n){e.exports=n(103)},98:function(e,t,n){}},[[88,1,2]]]);
//# sourceMappingURL=main.12b4bc75.chunk.js.map