{"version":3,"sources":["features/auth/authSlice.ts","features/auth/Auth.tsx","helpers/SignalingChannel.js","components/LinearProgressWithLabel/index.tsx","features/rtc/RTCPlayer.tsx","helpers/helpers.js","app/App.tsx","features/led/ledSlice.ts","app/rootReducer.ts","app/store.ts","index.tsx"],"names":["initialState","authSlice","createSlice","name","reducers","getProfile","state","action","payload","clearProfile","actions","useStyles","makeStyles","root","flexGrow","Auth","dispatch","useDispatch","useSelector","auth","shallowEqual","imageUrl","email","classes","isAuthenticated","Toolbar","className","List","ListItem","ListItemAvatar","Avatar","alt","src","ListItemText","primary","secondary","ListItemSecondaryAction","clientId","API_KEYS","GOOGLE_AUTH","buttonText","onLogoutSuccess","onSuccess","response","profileObj","id_token","tokenObj","onFailure","e","console","error","cookiePolicy","isSignedIn","SignalingChannel","signaling","this","message","send","JSON","stringify","data","handler","onMessage","parse","addEventListener","unsubscribe","log","removeEventListener","LinearProgressWithLabel","props","value","Box","display","alignItems","width","mr","LinearProgress","variant","minWidth","Typography","color","Math","round","configuration","iceServers","url","urls","credential","username","theme","margin","spacing","padding","progress","formControl","video","justifyContent","flexDirection","backgroundImage","process","backgroundSize","backgroundRepeat","minHeight","file","RTCPlayer","remoteVideoRef","useRef","pcRef","useState","maxProgress","setMaxProgress","progressValue","setProgressValue","selectedFile","setSelectedFile","snackbarSuccess","setSnackbarSuccess","snackbarError","setSnackbarError","room","setRoom","resetFileSelect","closeSuccessSnackbar","closeErrorSnackbar","useEffect","queryParamKey","queryParamValue","roomQueryParam","URLSearchParams","toString","URL","ws","WebSocket","onOpenWS","getRemoteMedia","pc","RTCPeerConnection","current","ontrack","track","stream","streams","onunmute","srcObject","makingOffer","ignoreOffer","isSettingRemoteAnswerPending","onicecandidate","candidate","onnegotiationneeded","a","setLocalDescription","description","localDescription","oniceconnectionstatechange","iceConnectionState","restartIce","onmessage","readyForOffer","signalingState","type","setRemoteDescription","addIceCandidate","onSendChannelStateChange","readyState","target","channel","event","close","dropbox","window","dragenter","stopPropagation","preventDefault","dragover","drop","dataTransfer","files","document","visibilityState","pictureInPictureElement","exitPictureInPicture","MAX","gutterBottom","FormControl","InputLabel","htmlFor","Select","native","onChange","label","inputProps","id","Array","from","length","_","idx","map","noRoom","roomIdx","key","disabled","aria-label","ref","autoPlay","playsInline","onClick","pictureInPictureEnabled","requestPictureInPicture","style","lastModifiedDate","toLocaleString","title","size","IconButton","edge","Button","component","sendFileChannel","createDataChannel","binaryType","fileReader","FileReader","offset","isPaused","readSlice","byteOffset","slice","readAsArrayBuffer","warn","buffer","result","byteLength","bufferedAmount","bufferedAmountLowThreshold","debug","onopen","Snackbar","open","autoHideDuration","onClose","Alert","severity","App","ledSlice","pin1","pin2","pin3","setLed","rootReducer","combineReducers","led","store","configureStore","reducer","require","default","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.18576060.chunk.js","sourcesContent":["import { createSlice, PayloadAction } from '@reduxjs/toolkit';\n\nexport type AuthState = {\n    googleId: string,\n    imageUrl: string,\n    email: string,\n    name: string,\n    givenName: string,\n    familyName: string,\n    id_token: string,\n}\n\nconst initialState = {};\n\nconst authSlice = createSlice({\n  name: 'auth',\n  initialState,\n  reducers: {\n    getProfile(state, action: PayloadAction<AuthState>) {\n      return action.payload;\n    },\n    clearProfile() {\n      return initialState;\n    },\n  },\n});\n\nexport const { getProfile, clearProfile } = authSlice.actions;\n\nexport default authSlice.reducer;\n","import React from 'react';\nimport { GoogleLogin, GoogleLogout } from 'react-google-login';\nimport { getProfile, clearProfile } from 'features/auth/authSlice';\nimport { shallowEqual, useDispatch, useSelector } from 'react-redux';\nimport {\n  Avatar,\n  List,\n  ListItem,\n  ListItemAvatar,\n  ListItemSecondaryAction,\n  ListItemText,\n  Toolbar,\n} from '@material-ui/core';\nimport API_KEYS from 'API_KEYS.json';\nimport { makeStyles } from '@material-ui/core/styles';\n\nconst useStyles = makeStyles(() => ({\n  root: {\n    flexGrow: 1,\n  },\n}));\n\nconst Auth = () => {\n  const dispatch = useDispatch();\n  const {\n    imageUrl,\n    email,\n    name,\n  } = useSelector((state: any) => state.auth, shallowEqual);\n  const classes = useStyles();\n\n  const isAuthenticated = !!name;\n\n  const onSuccess = (response: any) => {\n    dispatch(getProfile({ ...response.profileObj, id_token: response.tokenObj.id_token }));\n  };\n\n  const onFailure = (e: any) => {\n    console.error(e);\n  };\n\n  const onLogoutSuccess = () => {\n    dispatch(clearProfile());\n  };\n\n  return (\n    <Toolbar>\n      <div className={classes.root}>\n        <List>\n          <ListItem>\n            {name && (\n            <ListItemAvatar>\n              <Avatar>\n                <Avatar alt={name} src={imageUrl} />\n              </Avatar>\n            </ListItemAvatar>\n            )}\n            <ListItemText\n              primary={name}\n              secondary={email}\n            />\n            <ListItemSecondaryAction>\n              {isAuthenticated ? (\n                <GoogleLogout\n                  clientId={API_KEYS.GOOGLE_AUTH}\n                  buttonText=\"Выйти\"\n                  onLogoutSuccess={onLogoutSuccess}\n                />\n              ) : (\n                <GoogleLogin\n                  clientId={API_KEYS.GOOGLE_AUTH}\n                  buttonText=\"Войти\"\n                  onSuccess={onSuccess}\n                  onFailure={onFailure}\n                  cookiePolicy=\"single_host_origin\"\n                  isSignedIn\n                />\n              )}\n            </ListItemSecondaryAction>\n          </ListItem>\n        </List>\n      </div>\n    </Toolbar>\n  );\n};\n\nexport default Auth;\n","class SignalingChannel {\n  constructor(signaling) {\n    this.signaling = signaling;\n  }\n\n  send(message) {\n    this.signaling.send(JSON.stringify({ data: message }));\n  }\n\n  set onmessage(handler) {\n    const onMessage = ({ data }) => {\n      handler(JSON.parse(data));\n    };\n\n    this.signaling.addEventListener('message', onMessage);\n\n    /* TODO refactor */\n    this.unsubscribe = () => {\n      console.log('unsubscribe from message');\n      this.signaling.removeEventListener('message', onMessage);\n    };\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  unsubscribe() {\n    console.error('Method unsubscribe is not implemented');\n  }\n}\n\nexport { SignalingChannel };\n","import React from 'react';\nimport { Box, LinearProgress, Typography } from '@material-ui/core';\n\nconst LinearProgressWithLabel = (props: { value: number }) => {\n  const { value } = props;\n  return (\n    <Box display=\"flex\" alignItems=\"center\">\n      <Box width=\"100%\" mr={1}>\n        <LinearProgress variant=\"determinate\" {...props} />\n      </Box>\n      <Box minWidth={35}>\n        <Typography variant=\"body2\" color=\"textSecondary\">\n          {`${Math.round(value)}%`}\n        </Typography>\n      </Box>\n    </Box>\n  );\n};\n\nexport { LinearProgressWithLabel };\n","// @ts-nocheck\nimport React, { useEffect, useRef, useState } from 'react';\nimport { SignalingChannel } from 'helpers/SignalingChannel';\nimport { generateQueryParam } from 'helpers/helpers';\nimport { LinearProgressWithLabel } from 'components/LinearProgressWithLabel';\nimport 'features/rtc/RTCPlayer.css';\nimport {\n  Avatar,\n  Button,\n  IconButton,\n  List,\n  ListItem,\n  Typography,\n  FormControl,\n  ListItemAvatar,\n  ListItemSecondaryAction,\n  ListItemText,\n  Snackbar,\n  InputLabel,\n  Select,\n} from '@material-ui/core';\nimport FolderIcon from '@material-ui/icons/AddToPhotos';\nimport DeleteIcon from '@material-ui/icons/Delete';\nimport { Alert } from '@material-ui/lab';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { useSelector } from 'react-redux';\nimport { AppStore } from '../../app/store';\n\nconst QUERY_PARAM_ROOM_NAME = 'room';\nconst FILE_DATA_CHANNEL_BINARY_TYPE = 'arraybuffer';\nconst END_OF_FILE_MESSAGE = 'EOF';\n\nconst configuration = {\n  iceServers: [\n    { url: 'stun:stun.l.google.com:19302' },\n    { url: 'stun:stun1.l.google.com:19302' },\n    { url: 'stun:stun2.l.google.com:19302' },\n    { url: 'stun:stun3.l.google.com:19302' },\n    {\n      urls: 'turn:numb.viagenie.ca',\n      credential: '9u7prU:2}R{Sut~.)d[bP7,;Pgc\\'Pa',\n      username: 'fkrveacbukypqsqyaq@miucce.com',\n    },\n  ],\n};\n\nconst EMPTY_PROGRESS = 0;\nconst SNACKBAR_DELAY = 6000;\nconst NO_ROOM = '';\nconst polite = true;\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    flexGrow: 1,\n    '& > *': {\n      margin: theme.spacing(1),\n    },\n    padding: '2rem',\n  },\n  progress: {\n    width: '100%',\n  },\n  formControl: {\n    margin: theme.spacing(1),\n    minWidth: '10rem',\n  },\n  video: {\n    display: 'flex',\n    justifyContent: 'center',\n    flexDirection: 'column',\n    backgroundImage: `url(${process.env.PUBLIC_URL}/chip.png)`,\n    backgroundSize: '5.5rem',\n    backgroundRepeat: 'space',\n    width: '100%',\n    minHeight: '30rem',\n  },\n  file: {\n    display: 'flex',\n  },\n}));\n\nconst MIN = 0;\nconst normalize = (value, MAX) => ((value - MIN) * 100) / (MAX - MIN);\n\nconst RTCPlayer = () => {\n  const classes = useStyles();\n  const id_token = useSelector((state: AppStore) => state.auth.id_token);\n\n  const remoteVideoRef = useRef<HTMLVideoElement>(null);\n  const pcRef = useRef(null);\n\n  const [maxProgress, setMaxProgress] = useState(EMPTY_PROGRESS);\n  const [progressValue, setProgressValue] = useState(EMPTY_PROGRESS);\n  const [selectedFile, setSelectedFile] = useState(null);\n  const [snackbarSuccess, setSnackbarSuccess] = useState('');\n  const [snackbarError, setSnackbarError] = useState('');\n\n  const [room, setRoom] = useState<string>(NO_ROOM);\n\n  const resetFileSelect = () => setSelectedFile(null);\n  const closeSuccessSnackbar = () => setSnackbarSuccess('');\n  const closeErrorSnackbar = () => setSnackbarError('');\n\n  useEffect(() => {\n    if (room === NO_ROOM) {\n      return;\n    }\n\n    const roomQueryParam = generateQueryParam(QUERY_PARAM_ROOM_NAME, room);\n    const baseURL = 'wss://wss-signaling.herokuapp.com';\n    const url = new URL(`${roomQueryParam && `?${roomQueryParam}`}`, baseURL).toString();\n    const ws = new WebSocket(url, ['id_token', id_token]);\n\n    let signaling;\n    const onCloseWS = (e) => {\n      console.log('CLOSE WS', e);\n    };\n    const onOpenWS = (e) => {\n      console.log('OPEN WS', e);\n      signaling = new SignalingChannel(ws);\n      signaling.send({ getRemoteMedia: true });\n\n      const pc = new RTCPeerConnection(configuration);\n      pcRef.current = pc;\n\n      pc.ontrack = ({ track, streams: [stream] }) => {\n        // once media for a remote track arrives, show it in the remote video element\n        // eslint-disable-next-line no-param-reassign\n        track.onunmute = () => {\n          // don't set srcObject again if it is already set.\n          if (remoteVideoRef.current.srcObject) {\n            return;\n          }\n          remoteVideoRef.current.srcObject = stream;\n        };\n      };\n\n      // - The perfect negotiation logic, separated from the rest of the application ---\n\n      // keep track of some negotiation state to prevent races and errors\n      let makingOffer = false;\n      let ignoreOffer = false;\n      let isSettingRemoteAnswerPending = false;\n\n      // send any ice candidates to the other peer\n      pc.onicecandidate = ({ candidate }) => {\n        signaling.send({ candidate });\n      };\n\n      // let the \"negotiationneeded\" event trigger offer generation\n      pc.onnegotiationneeded = async () => {\n        try {\n          makingOffer = true;\n          await pc.setLocalDescription();\n          signaling.send({ description: pc.localDescription });\n        } catch (err) {\n          console.error(err);\n        } finally {\n          makingOffer = false;\n        }\n      };\n\n      pc.oniceconnectionstatechange = () => {\n        if (pc.iceConnectionState === 'failed') {\n          pc.restartIce();\n        }\n      };\n\n      signaling.onmessage = async ({ data, data: { description, candidate } }) => {\n        console.log(data);\n\n        try {\n          if (description) {\n            // An offer may come in while we are busy processing SRD(answer).\n            // In this case, we will be in \"stable\" by the time the offer is processed\n            // so it is safe to chain it on our Operations Chain now.\n            const readyForOffer = !makingOffer\n                && (pc.signalingState === 'stable' || isSettingRemoteAnswerPending);\n            const offerCollision = description.type === 'offer' && !readyForOffer;\n\n            ignoreOffer = !polite && offerCollision;\n            if (ignoreOffer) {\n              return;\n            }\n            isSettingRemoteAnswerPending = description.type === 'answer';\n            await pc.setRemoteDescription(description); // SRD rolls back as needed\n            isSettingRemoteAnswerPending = false;\n            if (description.type === 'offer') {\n              await pc.setLocalDescription();\n              signaling.send({ description: pc.localDescription });\n            }\n          } else if (candidate) {\n            try {\n              await pc.addIceCandidate(candidate);\n            } catch (err) {\n              if (!ignoreOffer) {\n                throw err;\n              } // Suppress ignored offer's candidates\n            }\n          }\n        } catch (err) {\n          console.error(err);\n        }\n      };\n\n      const onSendChannelStateChange = ({ target: { readyState } }) => {\n        console.log('Send channel state is: %s', readyState);\n      };\n\n      /* TODO remove as far as we do not accept any messages */\n      pc.addEventListener('datachannel', ({ channel }) => {\n        channel.addEventListener('message', (event) => {\n          console.log('Received Message: %s', event.data);\n        });\n        channel.addEventListener('open', onSendChannelStateChange);\n        channel.addEventListener('close', onSendChannelStateChange);\n      });\n    };\n    const onErrorWS = (e) => {\n      console.error('ERROR WS', e);\n      setSnackbarError(`Не удалось присоединиться к стенду ${room}`);\n    };\n\n    ws.addEventListener('open', onOpenWS);\n    ws.addEventListener('close', onCloseWS);\n    ws.addEventListener('error', onErrorWS);\n\n    // eslint-disable-next-line consistent-return\n    return () => {\n      ws.close(1000, 'change room');\n      if (pcRef.current) {\n        pcRef.current.close();\n      }\n      ws.removeEventListener('open', onOpenWS);\n      if (signaling) {\n        signaling.unsubscribe();\n      }\n      remoteVideoRef.current.srcObject = null;\n    };\n  }, [room]);\n\n  useEffect(() => {\n    /* TODO - add drop it text on fullscreen */\n    /* TODO - allow adding file form clipboard */\n    const dropbox = window;\n\n    dropbox.addEventListener('dragenter', dragenter, false);\n    dropbox.addEventListener('dragover', dragover, false);\n    dropbox.addEventListener('drop', drop, false);\n\n    function dragenter(e: any) {\n      e.stopPropagation();\n      e.preventDefault();\n    }\n\n    function dragover(e: any) {\n      e.stopPropagation();\n      e.preventDefault();\n    }\n\n    function drop(e: any) {\n      e.stopPropagation();\n      e.preventDefault();\n\n      const { dataTransfer: { files: [file] } } = e;\n      setSelectedFile(file);\n    }\n\n    return () => {\n      dropbox.removeEventListener('dragenter', dragenter, false);\n      dropbox.removeEventListener('dragover', dragover, false);\n      dropbox.removeEventListener('drop', drop, false);\n    };\n  }, []);\n\n  useEffect(() => {\n    const handler = () => {\n      if (document.visibilityState === 'visible' && document.pictureInPictureElement) {\n        document.exitPictureInPicture();\n      }\n    };\n\n    document.addEventListener('visibilitychange', handler);\n    return () => {\n      document.removeEventListener('visibilitychange', handler);\n    };\n  }, []);\n\n  const onChange = (e) => {\n    const [file] = e.target.files;\n    setSelectedFile(file);\n  };\n\n  const sendFile = () => {\n    /*\n          Label may not be longer than 65,535 bytes.\n          https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/createDataChannel#parameters:~:text=channel.%20This%20string-,may%20not%20be%20longer%20than%2065%2C535%20bytes.\n          Filename sizes may not exceed 255 bytes.\n          https://www.ibm.com/support/knowledgecenter/SSEQVQ_8.1.10/client/c_cmd_filespecsyntax.html\n      */\n    const dataConstraint = null;\n    /* TODO improve selectedFile transfering https://github.com/webrtc/samples/blob/gh-pages/src/content/datachannel/filetransfer/js/main.js */\n    /* TODO reuse data channel */\n    const sendFileChannel = pcRef.current.createDataChannel(selectedFile.name, dataConstraint);\n    sendFileChannel.binaryType = FILE_DATA_CHANNEL_BINARY_TYPE;\n    setMaxProgress(selectedFile.size);\n\n    /*\n    Firefox cannot send a message larger than 16 Kbytes to Chrome\n    https://viblast.com/blog/2015/2/5/webrtc-data-channel-message-size/#blog-body:~:text=Firefox%20cannot%20send%20a%20message%20larger%20than%2016%20Kbytes%20to%20Chrome\n    Messages smaller than 16kiB can be sent without concern,\n    as all major user agents handle them the same way.\n    Beyond that, things get more complicated.\n    https://developer.mozilla.org/en-US/docs/Web/API/WebRTC_API/Using_data_channels#understanding_message_size_limits\n\n    Tests have shown that targeting a high water mark of 1 MiB\n    and setting a low water mark of 256 KiB results in adequate throughput\n    https://stackoverflow.com/questions/56327783/webrtc-datachannel-for-high-bandwidth-application\n    https://github.com/w3c/webrtc-pc/issues/1979#issuecomment-486611845\n    */\n    // 2 ** 18 === 262144;\n    // 2 ** 20 === 1048576;\n    const CHUNK_SIZE = 262144;\n    const LOW_WATER_MARK = 262144;\n    const HIGH_WATER_MARK = 1048576;\n\n    const fileReader = new FileReader();\n    let offset = 0;\n\n    fileReader.addEventListener('error', (error) => {\n      console.error('Error reading selectedFile: ', error);\n    });\n\n    fileReader.addEventListener('abort', (event) => {\n      console.log('File reading aborted: ', event);\n    });\n\n    let isPaused = false;\n\n    const readSlice = (byteOffset) => {\n      console.log('readSlice', byteOffset);\n      const slice = selectedFile.slice(offset, byteOffset + CHUNK_SIZE);\n      fileReader.readAsArrayBuffer(slice);\n    };\n    // TODO UPDATE PAGE TITLE ON FILE LOAD\n    fileReader.addEventListener('load', (e) => {\n      console.log('FileReader.onload', e);\n      if (sendFileChannel.readyState !== 'open') {\n        console.warn('sendFileChannel.readyState is not open:', sendFileChannel.readyState);\n        return;\n      }\n\n      if (isPaused) {\n        console.warn('Unable to write, data channel is paused!');\n        return;\n      }\n\n      const buffer = e.target.result;\n      sendFileChannel.send(buffer);\n\n      offset += buffer.byteLength;\n      setProgressValue(offset);\n\n      if (offset >= selectedFile.size) {\n        sendFileChannel.send(END_OF_FILE_MESSAGE);\n        sendFileChannel.close();\n        setSelectedFile(null);\n        /* Reset progress */\n        setMaxProgress(EMPTY_PROGRESS);\n        setProgressValue(EMPTY_PROGRESS);\n        resetFileSelect();\n        setSnackbarSuccess('Файл успешно отправлен');\n        return;\n      }\n\n      if (isPaused || sendFileChannel.bufferedAmount < HIGH_WATER_MARK) {\n        readSlice(offset);\n      } else {\n        // Pause once high water mark has been reached\n        console.log(`Data channel ${sendFileChannel.label} paused @ ${sendFileChannel.bufferedAmount}`);\n        isPaused = true;\n      }\n      // Otherwise wait for bufferedamountlow event to trigger reading more data\n    });\n\n    sendFileChannel.bufferedAmountLowThreshold = LOW_WATER_MARK;\n    sendFileChannel.addEventListener('bufferedamountlow', () => {\n      if (isPaused) {\n        console.debug(`Data channel ${sendFileChannel.label} resumed @ ${sendFileChannel.bufferedAmount}`);\n        isPaused = false;\n        readSlice(offset);\n      }\n    });\n\n    sendFileChannel.onopen = () => {\n      const FIRST_BYTE_SLICE_NUMBER = 0;\n      readSlice(FIRST_BYTE_SLICE_NUMBER);\n    };\n  };\n\n  const onChangeRoom = (e) => {\n    setRoom(e.target.value);\n  };\n\n  const togglePictureInPicture = (e) => {\n    if (!remoteVideoRef.current?.srcObject) {\n      return;\n    }\n\n    if (document.pictureInPictureElement) {\n      document.exitPictureInPicture();\n    } else if (document.pictureInPictureEnabled) {\n      e.target.requestPictureInPicture();\n    }\n  };\n\n  return (\n    <div className={classes.root}>\n      <Typography variant=\"h5\" gutterBottom>Стенд</Typography>\n      <FormControl variant=\"filled\" className={classes.formControl}>\n        <InputLabel htmlFor=\"outlined-room-native-simple\">Стенд</InputLabel>\n        <Select\n          native\n          value={room}\n          onChange={onChangeRoom}\n          label=\"Стенда\"\n          inputProps={{\n            name: 'Стенд',\n            id: 'outlined-room-native-simple',\n          }}\n        >\n          {Array.from(({ length: 11 }), (_, idx) => idx)\n            .map((idx) => {\n              const noRoom = idx === 0;\n              const roomIdx = noRoom ? NO_ROOM : idx.toString();\n\n              return (\n                <option\n                  key={roomIdx}\n                  value={roomIdx}\n                  disabled={noRoom}\n                  aria-label={noRoom ? 'None' : roomIdx}\n                >\n                  {roomIdx}\n                </option>\n              );\n            })}\n        </Select>\n      </FormControl>\n      <section className={classes.video}>\n        {/* eslint-disable-next-line jsx-a11y/media-has-caption */}\n        <video\n          ref={remoteVideoRef}\n          autoPlay\n          playsInline\n          onClick={togglePictureInPicture}\n          // poster={`${process.env.PUBLIC_URL}/chip.png`}\n        />\n      </section>\n      <section>\n        <input type=\"file\" id=\"files\" style={{ display: 'none' }} onChange={onChange} />\n        {selectedFile && (\n        <List className={classes.file}>\n          <ListItem>\n            <ListItemAvatar>\n              <Avatar>\n                <FolderIcon />\n              </Avatar>\n            </ListItemAvatar>\n            <ListItemText primary={selectedFile.name} secondary={selectedFile.lastModifiedDate.toLocaleString()} title={`${selectedFile.size} байт`} />\n            <ListItemSecondaryAction>\n              <IconButton\n                edge=\"end\"\n                aria-label=\"delete\"\n                onClick={resetFileSelect}\n              >\n                <DeleteIcon />\n              </IconButton>\n            </ListItemSecondaryAction>\n          </ListItem>\n        </List>\n        )}\n        {progressValue > EMPTY_PROGRESS\n        && selectedFile\n          ? (\n            <div className={classes.progress}>\n              <LinearProgressWithLabel value={normalize(progressValue, maxProgress)} />\n            </div>\n          ) : <br />}\n        {selectedFile && (\n        <Button\n          component=\"button\"\n          color=\"primary\"\n          onClick={sendFile}\n          variant=\"contained\"\n          type=\"submit\"\n          size=\"small\"\n        >\n          Отправить\n        </Button>\n        )}\n        <Button\n          component=\"label\"\n          htmlFor=\"files\"\n          variant=\"contained\"\n          size=\"small\"\n          id=\"files\"\n        >\n          Загрузить прошивку\n        </Button>\n        <Snackbar\n          open={!!snackbarSuccess}\n          autoHideDuration={SNACKBAR_DELAY}\n          onClose={closeSuccessSnackbar}\n          onClick={closeSuccessSnackbar}\n        >\n          <Alert severity=\"success\">\n            {snackbarSuccess}\n          </Alert>\n        </Snackbar>\n        <Snackbar\n          open={!!snackbarError}\n          onClose={closeErrorSnackbar}\n          onClick={closeErrorSnackbar}\n        >\n          <Alert severity=\"error\">\n            {snackbarError}\n          </Alert>\n        </Snackbar>\n      </section>\n    </div>\n  );\n};\n\nexport default RTCPlayer;\n","export const generateQueryParam = (\n  queryParamKey, queryParamValue,\n) => new URLSearchParams({ [queryParamKey]: queryParamValue }).toString();\n","import React from 'react';\nimport Auth from 'features/auth/Auth';\nimport RTCPlayer from 'features/rtc/RTCPlayer';\nimport { useSelector } from 'react-redux';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars,no-unused-vars\nimport adapter from 'webrtc-adapter';\n\nconst App = () => {\n  const name = useSelector((state: any) => state.auth.name);\n  const isAuthenticated = !!name;\n\n  return (\n    <>\n      <Auth />\n      {isAuthenticated && (\n      <>\n        <RTCPlayer />\n        {/* FIXME <LedIndicator /> */}\n      </>\n      )}\n    </>\n  );\n};\n\nexport default App;\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\n\nexport type Led = {\n  pin1: boolean,\n  pin2: boolean,\n  pin3: boolean,\n}\n\nconst initialState: Led = {\n  pin1: false,\n  pin2: false,\n  pin3: false,\n};\n\nconst ledSlice = createSlice({\n  name: 'led',\n  initialState,\n  reducers: {\n    setLed(state, action: PayloadAction<Led>) {\n      return action.payload;\n    },\n  },\n});\n\nexport const { setLed } = ledSlice.actions;\n\nexport default ledSlice.reducer;\n","import { combineReducers } from '@reduxjs/toolkit';\n\nimport auth from 'features/auth/authSlice';\nimport led from 'features/led/ledSlice';\n\nconst rootReducer = combineReducers({\n  auth,\n  led,\n});\n\nexport type RootState = ReturnType<typeof rootReducer>\n\nexport default rootReducer;\n","import { configureStore, Action } from '@reduxjs/toolkit';\nimport { ThunkAction } from 'redux-thunk';\n\nimport rootReducer, { RootState } from 'app/rootReducer';\nimport { Led } from 'features/led/ledSlice';\nimport { AuthState } from 'features/auth/authSlice';\n\nconst store = configureStore({\n  reducer: rootReducer,\n});\n\n// @ts-ignore\nif (process.env.NODE_ENV === 'development' && module.hot) {\n  // @ts-ignore\n  module.hot.accept('./rootReducer', () => {\n    // eslint-disable-next-line global-require\n    const newRootReducer = require('./rootReducer').default;\n    store.replaceReducer(newRootReducer);\n  });\n}\n\nexport type AppDispatch = typeof store.dispatch\nexport type AppThunk = ThunkAction<void, RootState, null, Action<string>>\nexport type AppStore = { led: Led, auth: AuthState };\n\nexport default store;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Provider } from 'react-redux';\n\nimport store from './app/store';\nimport './index.css';\n\nfunction render() {\n  // eslint-disable-next-line global-require\n  const App = require('./app/App').default;\n  ReactDOM.render(\n    <Provider store={store}>\n      <App />\n    </Provider>,\n    document.getElementById('root'),\n  );\n}\n\nrender();\n\n// @ts-ignore\nif (process.env.NODE_ENV === 'development' && module.hot) {\n  // @ts-ignore\n  module.hot.accept('./app/App', render);\n}\n"],"sourceRoot":""}